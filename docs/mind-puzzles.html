<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ù„ØºØ§Ø² Ø§Ù„Ø¹Ù‚Ù„</title>
    <script src="js/translations.js"></script>
    <script src="js/game-economy.js"></script>
    <script src="js/player-header.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            max-width: 100%;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a2332 25%, #2d3748 50%, #1a365d 75%, #2c5282 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .game-container {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(25px);
            border-radius: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 30px;
            text-align: center;
            overflow: hidden;
            position: relative;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .back-btn {
            background: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);
            border: 2px solid rgba(255, 215, 0, 0.6);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.5);
        }

        .game-title {
            font-size: 1.8em;
            font-weight: bold;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .score-display {
            font-size: 1.2em;
            color: #ffd700;
            font-weight: bold;
        }

        .puzzle-area {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0.1) 100%);
            border-radius: 15px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            padding: 30px;
            margin: 20px 0;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .puzzle-question {
            font-size: 1.3em;
            margin-bottom: 30px;
            line-height: 1.6;
            text-align: center;
            color: #fff;
        }

        .puzzle-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
            max-width: 400px;
        }

        .option-btn {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .option-btn:hover {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 215, 0, 0.1) 100%);
            border-color: rgba(255, 215, 0, 0.6);
            transform: translateY(-3px);
        }

        .option-btn.correct {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
        }

        .option-btn.wrong {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-color: #ef4444;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffc107 100%);
            border: 3px solid rgba(255, 215, 0, 0.9);
            border-radius: 15px;
            padding: 12px 24px;
            color: #1a202c;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(255, 215, 0, 0.6);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffd700;
        }

        .stat-label {
            font-size: 0.9em;
            color: #ccc;
            margin-top: 5px;
        }

        .result-message {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            display: none;
        }

        .result-message.correct {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.1) 100%);
            border: 1px solid rgba(16, 185, 129, 0.5);
            color: #10b981;
        }

        .result-message.wrong {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.1) 100%);
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: #ef4444;
        }

        /* ØªØµÙ…ÙŠÙ… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„ØºØ² */
        .puzzle-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 10px 15px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .category {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .difficulty {
            color: #ffd700;
            font-weight: bold;
        }

        .points {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #1a202c;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .question-text {
            font-size: 1.1em;
            line-height: 1.6;
            color: #e2e8f0;
        }

        @media (max-width: 768px) {
            .game-container {
                margin: 2px;
                padding: 8px;
                max-width: 100vw;
                box-sizing: border-box;
            }

            .header {
                margin-bottom: 5px;
                padding: 4px 6px;
                flex-wrap: wrap;
            }

            .game-title {
                font-size: 0.9em;
                order: 1;
                flex: 1;
                text-align: center;
            }

            .back-btn {
                width: 30px;
                height: 30px;
                font-size: 1em;
                order: 0;
            }

            .stats {
                grid-template-columns: repeat(3, 1fr);
                gap: 4px;
                margin: 5px 0;
            }

            .stat-item {
                padding: 4px 6px;
                border-radius: 6px;
            }

            .stat-value {
                font-size: 1em;
            }

            .stat-label {
                font-size: 0.7em;
            }

            .puzzle-info {
                flex-direction: column;
                gap: 4px;
                text-align: center;
                padding: 6px 8px;
                margin-bottom: 8px;
            }

            .puzzle-info > span {
                font-size: 0.7em;
            }

            .question-text {
                font-size: 0.9em;
                line-height: 1.4;
            }

            .puzzle-options {
                grid-template-columns: 1fr;
                gap: 8px;
                max-width: 100%;
            }

            .option-btn {
                padding: 10px;
                font-size: 0.85em;
                border-radius: 8px;
            }

            .controls {
                gap: 4px;
                margin: 8px 0;
                flex-wrap: wrap;
            }

            .control-btn {
                padding: 6px 10px;
                font-size: 0.75em;
                border-radius: 8px;
                flex: 1;
                min-width: 100px;
            }

            .result-message {
                padding: 8px;
                font-size: 0.8em;
                margin: 8px 0;
                border-radius: 8px;
            }
        }

        @media (max-width: 480px) {
            .puzzle-options {
                grid-template-columns: 1fr;
                gap: 6px;
            }

            .option-btn {
                padding: 8px;
                font-size: 0.8em;
            }

            .controls {
                flex-direction: column;
                align-items: center;
                gap: 6px;
            }

            .control-btn {
                width: 100%;
                max-width: 200px;
                margin: 2px 0;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ -->
        <div id="player-header-container"></div>

        <div class="header">
            <button class="back-btn" onclick="goBack()" title="Ø§Ù„Ø¹ÙˆØ¯Ø©">
                â†
            </button>
            <h1 class="game-title">ğŸ§  Ø£Ù„ØºØ§Ø² Ø§Ù„Ø¹Ù‚Ù„</h1>
            <div class="score-display">
                Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="correct">0</div>
                <div class="stat-label">ØµØ­ÙŠØ­</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="wrong">0</div>
                <div class="stat-label">Ø®Ø·Ø£</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="level">1</div>
                <div class="stat-label">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
            </div>
        </div>

        <div class="puzzle-area">
            <div class="puzzle-question" id="puzzleQuestion">
                Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ù„ØºØ² Ø¬Ø¯ÙŠØ¯" Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨! ğŸ¯
            </div>
            <div class="puzzle-options" id="puzzleOptions">
                <!-- Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
        </div>

        <div class="result-message" id="resultMessage">
            <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
        </div>

        <div class="controls">
            <button class="control-btn" onclick="enableAudio(); playSound('click'); newPuzzle()">ğŸ§© Ù„ØºØ² Ø¬Ø¯ÙŠØ¯</button>
            <button class="control-btn" onclick="enableAudio(); playSound('click'); resetGame()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
            <button class="control-btn" onclick="enableAudio(); playSound('hint'); showHint()">ğŸ’¡ ØªÙ„Ù…ÙŠØ­</button>
            <button class="control-btn" onclick="toggleSound()" id="sound-btn">ğŸ”Š Ø§Ù„ØµÙˆØª</button>
        </div>
    </div>

    <script>
        let gameState = {
            score: 0,
            correct: 0,
            wrong: 0,
            level: 1,
            currentPuzzle: null,
            economySession: null,
            betAmount: 15, // ØªÙƒÙ„ÙØ© ÙƒÙ„ Ù„ØºØ²
            soundEnabled: true // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª
        };

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ØµÙˆØ§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Web Audio API
        let audioContext;
        let audioInitialized = false;

        // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                console.log('ğŸ”Š ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª - Ø£Ù„ØºØ§Ø² Ø§Ù„Ø¹Ù‚Ù„');
            } catch (error) {
                console.log('ğŸ”‡ Web Audio API ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…');
                gameState.soundEnabled = false;
            }
        }

        // ØªÙØ¹ÙŠÙ„ AudioContext Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ØªÙØ§Ø¹Ù„
        function enableAudio() {
            if (!audioInitialized && audioContext) {
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        audioInitialized = true;
                        console.log('ğŸ”Š ØªÙ… ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª - Ø£Ù„ØºØ§Ø² Ø§Ù„Ø¹Ù‚Ù„');
                        setTimeout(() => playSound('click'), 100);
                    });
                } else {
                    audioInitialized = true;
                    console.log('ğŸ”Š Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª Ø¬Ø§Ù‡Ø² - Ø£Ù„ØºØ§Ø² Ø§Ù„Ø¹Ù‚Ù„');
                }
            }
        }

        // Ø¯Ø§Ù„Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£ØµÙˆØ§Øª
        function playSound(type) {
            if (!gameState.soundEnabled || !audioContext) return;

            // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙØ¹Ù„Ø§Ù‹
            if (!audioInitialized) {
                enableAudio();
                return;
            }

            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„ØµÙˆØª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø¯Ø«
                switch(type) {
                    case 'click':
                        // ØµÙˆØª Ù†Ù‚Ø±Ø© Ø¹Ø§Ø¯ÙŠØ©
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                        oscillator.type = 'sine';
                        break;

                    case 'correct':
                        // ØµÙˆØª Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©
                        oscillator.frequency.setValueAtTime(523, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(784, audioContext.currentTime + 0.3);
                        gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        oscillator.type = 'triangle';
                        break;

                    case 'wrong':
                        // ØµÙˆØª Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©
                        oscillator.frequency.setValueAtTime(220, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(110, audioContext.currentTime + 0.4);
                        gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                        oscillator.type = 'sawtooth';
                        break;

                    case 'levelUp':
                        // ØµÙˆØª Ø§Ø±ØªÙ‚Ø§Ø¡ Ù…Ø³ØªÙˆÙ‰
                        oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.5);
                        gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                        oscillator.type = 'square';
                        break;

                    case 'hint':
                        // ØµÙˆØª Ø§Ù„ØªÙ„Ù…ÙŠØ­
                        oscillator.frequency.setValueAtTime(659, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(523, audioContext.currentTime + 0.2);
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                        oscillator.type = 'sine';
                        break;

                    default:
                        return;
                }

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);

            } catch (error) {
                console.log('ğŸ”‡ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª');
            }
        }

        // Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØª
        function toggleSound() {
            enableAudio();

            gameState.soundEnabled = !gameState.soundEnabled;
            const soundBtn = document.getElementById('sound-btn');

            if (gameState.soundEnabled) {
                soundBtn.textContent = 'ğŸ”Š Ø§Ù„ØµÙˆØª';
                soundBtn.style.opacity = '1';
                setTimeout(() => playSound('click'), 100);
            } else {
                soundBtn.textContent = 'ğŸ”‡ ØµØ§Ù…Øª';
                soundBtn.style.opacity = '0.6';
            }

            localStorage.setItem('mind-puzzles-sound-enabled', gameState.soundEnabled);
        }

        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª
        function restoreSoundSettings() {
            const savedSetting = localStorage.getItem('mind-puzzles-sound-enabled');
            if (savedSetting !== null) {
                gameState.soundEnabled = savedSetting === 'true';
            }

            const soundBtn = document.getElementById('sound-btn');
            if (gameState.soundEnabled) {
                soundBtn.textContent = 'ğŸ”Š Ø§Ù„ØµÙˆØª';
                soundBtn.style.opacity = '1';
            } else {
                soundBtn.textContent = 'ğŸ”‡ ØµØ§Ù…Øª';
                soundBtn.style.opacity = '0.6';
            }
        }

        const puzzles = [
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù„Ø³Ù„Ø©ØŸ\n2, 4, 8, 16, ?",
                options: ["24", "32", "20", "30"],
                correct: 1,
                hint: "ÙƒÙ„ Ø±Ù‚Ù… Ù‡Ùˆ Ø¶Ø¹Ù Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚",
                difficulty: 1,
                category: "Ø±ÙŠØ§Ø¶ÙŠØ§Øª",
                points: 10
            },
            {
                question: "Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡ØŒ ÙÙ…Ø§ Ù‡Ùˆ Ø§Ù„ÙŠÙˆÙ… Ø¨Ø¹Ø¯ 100 ÙŠÙˆÙ…ØŸ",
                options: ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡"],
                correct: 2,
                hint: "100 Ã· 7 = 14 Ø£Ø³Ø¨ÙˆØ¹ Ùˆ 2 ÙŠÙˆÙ… Ø¥Ø¶Ø§ÙÙŠ",
                difficulty: 2,
                category: "Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª",
                points: 15
            },
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø°ÙŠ Ø¥Ø°Ø§ Ø¶Ø±Ø¨ØªÙ‡ ÙÙŠ Ù†ÙØ³Ù‡ ÙˆØ£Ø¶ÙØª Ø¥Ù„ÙŠÙ‡ 5 ÙŠØµØ¨Ø­ 30ØŸ",
                options: ["5", "6", "4", "7"],
                correct: 0,
                hint: "xÂ² + 5 = 30ØŒ Ø¥Ø°Ù† xÂ² = 25",
                difficulty: 2,
                category: "Ø¬Ø¨Ø±",
                points: 15
            },
            {
                question: "ÙƒÙ… Ù…Ø«Ù„Ø« ÙŠÙ…ÙƒÙ†Ùƒ Ø£Ù† ØªØ¬Ø¯ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø´ÙƒÙ„ØŸ â¬Ÿ",
                options: ["3", "6", "9", "12"],
                correct: 1,
                hint: "Ù„Ø§ ØªÙ†Ø³ Ø§Ù„Ù…Ø«Ù„Ø«Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© ÙˆØ§Ù„ÙƒØ¨ÙŠØ±Ø©",
                difficulty: 2,
                category: "Ù‡Ù†Ø¯Ø³Ø©",
                points: 15
            },
            {
                question: "Ø¥Ø°Ø§ ÙƒØ§Ù† 5 + 5 = 10ØŒ Ùˆ 10 + 10 = 40ØŒ ÙÙƒÙ… ÙŠØ³Ø§ÙˆÙŠ 15 + 15ØŸ",
                options: ["30", "60", "90", "120"],
                correct: 2,
                hint: "Ø§Ù†Ø¸Ø± Ù„Ù„Ù†Ù…Ø·: 5Ã—2=10ØŒ 10Ã—4=40",
                difficulty: 3,
                category: "Ø£Ù†Ù…Ø§Ø·",
                points: 20
            },
            // Ø£Ù„ØºØ§Ø² Ù…Ù†Ø·Ù‚ÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø©
            {
                question: "Ù…Ø§ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠØ²ÙŠØ¯ ÙƒÙ„Ù…Ø§ Ø£Ø®Ø°Øª Ù…Ù†Ù‡ØŸ",
                options: ["Ø§Ù„Ø­ÙØ±Ø©", "Ø§Ù„Ù…Ø¹Ø±ÙØ©", "Ø§Ù„ÙˆÙ‚Øª", "Ø§Ù„Ù…Ø§Ù„"],
                correct: 0,
                hint: "ÙÙƒØ± ÙÙŠ Ø´ÙŠØ¡ ÙŠØµØ¨Ø­ Ø£ÙƒØ¨Ø± Ø¹Ù†Ø¯Ù…Ø§ ØªØ²ÙŠÙ„ Ù…Ù†Ù‡",
                difficulty: 2,
                category: "Ø£Ù„ØºØ§Ø² Ù„ÙØ¸ÙŠØ©",
                points: 15
            },
            {
                question: "Ù„Ø¯ÙŠÙƒ 12 ÙƒØ±Ø©ØŒ Ø¥Ø­Ø¯Ø§Ù‡Ø§ Ø£Ø«Ù‚Ù„ Ù…Ù† Ø§Ù„Ø¨Ø§Ù‚ÙŠ. ÙƒÙ… Ù…Ø±Ø© ØªØ­ØªØ§Ø¬ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙŠØ²Ø§Ù† Ù„ØªØ¬Ø¯Ù‡Ø§ØŸ",
                options: ["2", "3", "4", "5"],
                correct: 1,
                hint: "Ù‚Ø³Ù… Ø§Ù„ÙƒØ±Ø§Øª Ø¥Ù„Ù‰ 3 Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…ØªØ³Ø§ÙˆÙŠØ©",
                difficulty: 4,
                category: "Ù…Ù†Ø·Ù‚ Ù…ØªÙ‚Ø¯Ù…",
                points: 25
            },
            {
                question: "ÙÙŠ Ø³Ø¨Ø§Ù‚ØŒ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø¹Ø¯Ø§Ø¡ ÙÙŠ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø«Ø§Ù†ÙŠ. ÙÙŠ Ø£ÙŠ Ù…Ø±ÙƒØ² Ø£ØµØ¨Ø­ØªØŸ",
                options: ["Ø§Ù„Ø£ÙˆÙ„", "Ø§Ù„Ø«Ø§Ù†ÙŠ", "Ø§Ù„Ø«Ø§Ù„Ø«", "Ø§Ù„Ø±Ø§Ø¨Ø¹"],
                correct: 1,
                hint: "Ø¥Ø°Ø§ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø«Ø§Ù†ÙŠØŒ ÙØ£Ù†Øª ØªØ£Ø®Ø° Ù…ÙƒØ§Ù†Ù‡",
                difficulty: 3,
                category: "Ù…Ù†Ø·Ù‚",
                points: 20
            },
            {
                question: "Ø±Ø¬Ù„ ÙŠØ¹ÙŠØ´ ÙÙŠ Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø¹Ø´Ø±ÙŠÙ†. ÙƒÙ„ ÙŠÙˆÙ… ÙŠÙ†Ø²Ù„ Ø¨Ø§Ù„Ù…ØµØ¹Ø¯ Ù„Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø£Ø±Ø¶ÙŠØŒ Ù„ÙƒÙ† Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© ÙŠØµØ¹Ø¯ Ù„Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø¹Ø§Ø´Ø± ÙÙ‚Ø· Ø«Ù… ÙŠÙ…Ø´ÙŠ. Ù„Ù…Ø§Ø°Ø§ØŸ",
                options: ["Ø§Ù„Ù…ØµØ¹Ø¯ Ù…Ø¹Ø·Ù„", "Ù‚ØµÙŠØ± Ø§Ù„Ù‚Ø§Ù…Ø©", "ÙŠØ­Ø¨ Ø§Ù„Ø±ÙŠØ§Ø¶Ø©", "ÙŠØ®Ø§Ù Ø§Ù„Ù…Ø±ØªÙØ¹Ø§Øª"],
                correct: 1,
                hint: "ÙÙƒØ± ÙÙŠ Ù‚Ø¯Ø±ØªÙ‡ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ØµØ¹Ø¯",
                difficulty: 3,
                category: "Ø£Ù„ØºØ§Ø² Ù„ÙØ¸ÙŠØ©",
                points: 20
            },
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø°ÙŠ Ø¥Ø°Ø§ Ø¶Ø±Ø¨ØªÙ‡ ÙÙŠ 4 ÙˆØ·Ø±Ø­Øª Ù…Ù†Ù‡ 6 ÙˆÙ‚Ø³Ù…ØªÙ‡ Ø¹Ù„Ù‰ 2 ÙŠØµØ¨Ø­ 9ØŸ",
                options: ["6", "7", "8", "9"],
                correct: 0,
                hint: "Ø§Ø¹Ù…Ù„ Ø¨Ø§Ù„Ø¹ÙƒØ³: 9Ã—2+6Ã·4",
                difficulty: 4,
                category: "Ø¬Ø¨Ø±",
                points: 25
            },
            {
                question: "Ù„Ø¯ÙŠÙƒ 3 ØµÙ†Ø§Ø¯ÙŠÙ‚: Ø£Ø­Ø¯Ù‡Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØªÙØ§Ø­ØªÙŠÙ†ØŒ ÙˆØ§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ù„Ù‰ Ø¨Ø±ØªÙ‚Ø§Ù„ØªÙŠÙ†ØŒ ÙˆØ§Ù„Ø«Ø§Ù„Ø« Ø¹Ù„Ù‰ ØªÙØ§Ø­Ø© ÙˆØ¨Ø±ØªÙ‚Ø§Ù„Ø©. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª Ø®Ø§Ø·Ø¦Ø©. ÙƒÙ… ÙØ§ÙƒÙ‡Ø© ØªØ­ØªØ§Ø¬ Ù„Ø³Ø­Ø¨Ù‡Ø§ Ù„ØªØ¹Ø±Ù Ù…Ø­ØªÙˆÙ‰ ÙƒÙ„ ØµÙ†Ø¯ÙˆÙ‚ØŸ",
                options: ["1", "2", "3", "4"],
                correct: 0,
                hint: "Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…ÙƒØªÙˆØ¨ Ø¹Ù„ÙŠÙ‡ 'Ù…Ø®ØªÙ„Ø·'",
                difficulty: 5,
                category: "Ù…Ù†Ø·Ù‚ Ù…ØªÙ‚Ø¯Ù…",
                points: 30
            },
            {
                question: "Ø¥Ø°Ø§ ÙƒØ§Ù† 1=5ØŒ 2=25ØŒ 3=325ØŒ 4=4325ØŒ ÙÙ…Ø§ Ù‡Ùˆ 5=ØŸ",
                options: ["54325", "5", "55325", "543255"],
                correct: 1,
                hint: "Ø§Ù†Ø¸Ø± Ù„Ù„Ù†Ù…Ø· Ø¨Ø¹Ù†Ø§ÙŠØ©... Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ Ø§Ù„Ø¬ÙˆØ§Ø¨ Ø£Ø¨Ø³Ø· Ù…Ù…Ø§ ØªØªÙˆÙ‚Ø¹",
                difficulty: 5,
                category: "Ø£Ù†Ù…Ø§Ø· Ù…ØªÙ‚Ø¯Ù…Ø©",
                points: 30
            },
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¶Ù„Ø§Ø¹ ÙÙŠ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø°ÙŠ Ù…Ø¬Ù…ÙˆØ¹ Ø²ÙˆØ§ÙŠØ§Ù‡ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© 1080Â°ØŸ",
                options: ["6", "7", "8", "9"],
                correct: 2,
                hint: "Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†: (n-2) Ã— 180Â°",
                difficulty: 3,
                category: "Ù‡Ù†Ø¯Ø³Ø©",
                points: 20
            },
            {
                question: "Ø¥Ø°Ø§ ÙƒØ§Ù† 3x + 7 = 22ØŒ ÙÙ…Ø§ Ù‚ÙŠÙ…Ø© xØŸ",
                options: ["5", "6", "4", "7"],
                correct: 0,
                hint: "Ø§Ø·Ø±Ø­ 7 Ù…Ù† Ø§Ù„Ø·Ø±ÙÙŠÙ† Ø«Ù… Ø§Ù‚Ø³Ù… Ø¹Ù„Ù‰ 3",
                difficulty: 2,
                category: "Ø¬Ø¨Ø±",
                points: 15
            }
        ];

        function goBack() {
            window.close();
            window.history.back();
        }

        function goToMainPage() {
            window.location.href = '/';
        }

        function updateDisplay() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('correct').textContent = gameState.correct;
            document.getElementById('wrong').textContent = gameState.wrong;
            document.getElementById('level').textContent = gameState.level;
        }

        function newPuzzle() {
            const randomIndex = Math.floor(Math.random() * puzzles.length);
            gameState.currentPuzzle = puzzles[randomIndex];

            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„ØºØ² Ù…Ø¹ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø­Ø³Ù†
            const questionElement = document.getElementById('puzzleQuestion');
            questionElement.innerHTML = `
                <div class="puzzle-info">
                    <span class="category">ğŸ“‚ ${gameState.currentPuzzle.category || 'Ø¹Ø§Ù…'}</span>
                    <span class="difficulty">â­ ${getDifficultyStars(gameState.currentPuzzle.difficulty || 1)}</span>
                    <span class="points">ğŸ’ ${gameState.currentPuzzle.points || 10} Ù†Ù‚Ø·Ø©</span>
                </div>
                <div class="question-text">${gameState.currentPuzzle.question}</div>
            `;

            const optionsContainer = document.getElementById('puzzleOptions');
            optionsContainer.innerHTML = '';

            gameState.currentPuzzle.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => checkAnswer(index);
                optionsContainer.appendChild(btn);
            });

            document.getElementById('resultMessage').style.display = 'none';
        }

        function getDifficultyStars(difficulty) {
            return 'â­'.repeat(difficulty) + 'â˜†'.repeat(5 - difficulty);
        }

        async function checkAnswer(selectedIndex) {
            const resultMessage = document.getElementById('resultMessage');
            const options = document.querySelectorAll('.option-btn');

            // ØªØ¹Ø·ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            options.forEach(btn => btn.style.pointerEvents = 'none');

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ Ø¨ØµÙ…Øª
            let economyAvailable = false;
            try {
                if (window.gameEconomy && typeof window.gameEconomy.canPlay === 'function') {
                    const canPlayCheck = window.gameEconomy.canPlay(gameState.betAmount);
                    if (!canPlayCheck.canPlay) {
                        alert(canPlayCheck.reason);
                        return;
                    }
                    economyAvailable = true;
                } else {
                    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¯Ø±ÙŠØ¨
                    console.log('ğŸ® ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¯Ø±ÙŠØ¨');
                    economyAvailable = false;
                }
            } catch (error) {
                // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ØŒ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¯ÙˆÙ† Ù†Ø¸Ø§Ù… Ø§Ù‚ØªØµØ§Ø¯ÙŠ
                console.log('ğŸ® ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¯Ø±ÙŠØ¨');
                economyAvailable = false;
            }

            if (selectedIndex === gameState.currentPuzzle.correct) {
                // Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©
                options[selectedIndex].classList.add('correct');
                const pointsEarned = gameState.level * 10;
                gameState.score += pointsEarned;
                gameState.correct++;
                gameState.level++;

                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ
                try {
                    const economicResult = window.gameEconomy.calculateGameResult(
                        pointsEarned,
                        'mind-puzzles',
                        gameState.betAmount
                    );

                    const gameResult = {
                        isWin: economicResult.isWin,
                        winAmount: economicResult.winAmount,
                        lossAmount: gameState.betAmount,
                        playerScore: pointsEarned,
                        skillFactor: economicResult.skillFactor,
                        economicFactor: economicResult.economicFactor,
                        probability: economicResult.probability
                    };

                    const balanceUpdate = await window.gameEconomy.updatePlayerBalance(gameResult);
                    if (balanceUpdate.success) {
                        console.log(`ğŸ’° ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯: ${balanceUpdate.newBalance} (ØªØºÙŠÙŠØ±: ${balanceUpdate.change})`);
                        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø±ØµÙŠØ¯ ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø±
                        if (window.playerHeader) {
                            window.playerHeader.updateBalance(balanceUpdate.newBalance);
                        }
                    }
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯:', error);
                }

                // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
                playSound('correct');

                // Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ÙƒÙ„ 3 Ø¥Ø¬Ø§Ø¨Ø§Øª ØµØ­ÙŠØ­Ø©
                if (gameState.correct % 3 === 0) {
                    playSound('levelUp');
                    resultMessage.innerHTML = `ğŸ‰ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! +${pointsEarned} Ù†Ù‚Ø·Ø©<br>ğŸ†™ Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯: ${gameState.level}`;
                } else {
                    resultMessage.textContent = `ğŸ‰ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! +${pointsEarned} Ù†Ù‚Ø·Ø©`;
                }
                resultMessage.className = 'result-message correct';
            } else {
                // Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©
                options[selectedIndex].classList.add('wrong');
                options[gameState.currentPuzzle.correct].classList.add('correct');
                gameState.wrong++;

                // Ø®ØµÙ… ØªÙƒÙ„ÙØ© Ø§Ù„Ù„Ø¹Ø¨ Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£
                try {
                    const gameResult = {
                        isWin: false,
                        winAmount: 0,
                        lossAmount: gameState.betAmount,
                        playerScore: 0,
                        skillFactor: 0,
                        economicFactor: 0.5,
                        probability: 0
                    };

                    const balanceUpdate = await window.gameEconomy.updatePlayerBalance(gameResult);
                    if (balanceUpdate.success) {
                        console.log(`ğŸ’° ØªÙ… Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯: ${balanceUpdate.newBalance} (ØªØºÙŠÙŠØ±: ${balanceUpdate.change})`);
                        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø±ØµÙŠØ¯ ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø±
                        if (window.playerHeader) {
                            window.playerHeader.updateBalance(balanceUpdate.newBalance);
                        }
                    }
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯:', error);
                }

                // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©
                playSound('wrong');

                resultMessage.innerHTML = `âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©!<br>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${gameState.currentPuzzle.options[gameState.currentPuzzle.correct]}`;
                resultMessage.className = 'result-message wrong';
            }

            resultMessage.style.display = 'block';
            updateDisplay();

            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†
            setTimeout(() => {
                options.forEach(btn => btn.style.pointerEvents = 'auto');
            }, 3000);
        }

        function showHint() {
            if (gameState.currentPuzzle && gameState.currentPuzzle.hint) {
                alert(`ğŸ’¡ ØªÙ„Ù…ÙŠØ­: ${gameState.currentPuzzle.hint}`);
            } else {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ„Ù…ÙŠØ­ Ù…ØªØ§Ø­. Ø§Ø®ØªØ± Ù„ØºØ² Ø¬Ø¯ÙŠØ¯ Ø£ÙˆÙ„Ø§Ù‹!');
            }
        }

        function resetGame() {
            gameState = {
                score: 0,
                correct: 0,
                wrong: 0,
                level: 1,
                currentPuzzle: null
            };
            
            document.getElementById('puzzleQuestion').textContent = 'Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ù„ØºØ² Ø¬Ø¯ÙŠØ¯" Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨! ğŸ¯';
            document.getElementById('puzzleOptions').innerHTML = '';
            document.getElementById('resultMessage').style.display = 'none';
            updateDisplay();
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ
        async function initializeEconomy() {
            try {
                if (window.gameEconomy) {
                    gameState.economySession = await window.gameEconomy.initializeGameSession('mind-puzzles', gameState.betAmount);
                    console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ Ù„Ø£Ù„ØºØ§Ø² Ø§Ù„Ø¹Ù‚Ù„');
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ:', error);
            }
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', async function() {
            // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª
            initAudio();

            // ØªÙ‡ÙŠØ¦Ø© Ù‡ÙŠØ¯Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨
            if (window.playerHeader) {
                await window.playerHeader.init();
                const headerContainer = document.getElementById('player-header-container');
                if (headerContainer) {
                    window.playerHeader.insertHeader(headerContainer);
                }
            }

            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª
            restoreSoundSettings();

            if (window.languageManager) {
                window.languageManager.translatePage();
            }
            await initializeEconomy();
            updateDisplay();
        });
    </script>
</body>
</html>
