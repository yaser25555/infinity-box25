<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ù‚Ø·Ù Ø§Ù„ÙÙˆØ§ÙƒÙ‡ Ø§Ù„Ù…Ø·ÙˆØ±Ø© - INFINITY BOX</title>
    <script src="js/translations.js"></script>
    <script src="js/game-economy.js"></script>
    <script src="js/player-header.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #2c3e50 100%);
            margin: 0;
            padding: 0;
            overflow: hidden;
            user-select: none;
            touch-action: none;
            /* Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙˆØ§Ù„ØªÙƒØ¨ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -webkit-touch-callout: none;
            -webkit-text-size-adjust: none;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 25%, #1e3c72 50%, #2a5298 75%, #1e3c72 100%);
            animation: backgroundShift 20s ease-in-out infinite;
            /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ */
            will-change: background;
            transform: translateZ(0);
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³ */
        .touch-control-area {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 150px;
            background: linear-gradient(to top,
                rgba(255, 255, 255, 0.05) 0%,
                transparent 100%);
            pointer-events: none;
            z-index: 1;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .touch-control-area::before {
            content: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ­ÙƒÙ…';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.3);
            font-size: 12px;
            font-weight: bold;
        }

        @keyframes backgroundShift {
            0% { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 25%, #1e3c72 50%, #2a5298 75%, #1e3c72 100%); }
            25% { background: linear-gradient(135deg, #2a5298 0%, #1e3c72 25%, #2a5298 50%, #1e3c72 75%, #2a5298 100%); }
            50% { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 25%, #3b82c4 50%, #2a5298 75%, #1e3c72 100%); }
            75% { background: linear-gradient(135deg, #2a5298 0%, #3b82c4 25%, #1e3c72 50%, #2a5298 75%, #1e3c72 100%); }
            100% { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 25%, #1e3c72 50%, #2a5298 75%, #1e3c72 100%); }
        }

        .game-header {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            font-size: 14px;
        }

        .home-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            margin-left: 10px;
        }

        .home-btn:hover {
            background: linear-gradient(135deg, #45a049, #4CAF50);
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .home-btn:active {
            transform: scale(0.95);
        }

        .mute-btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            margin-left: 10px;
        }

        .mute-btn:hover {
            background: linear-gradient(135deg, #1976D2, #2196F3);
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .mute-btn:active {
            transform: scale(0.95);
        }

        .mute-btn.muted {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬ÙˆØ§Ù„ */
        @media (max-width: 768px) {
            .home-btn {
                width: 45px;
                height: 45px;
                font-size: 20px;
                margin-left: 5px;
            }

            .mute-btn {
                width: 45px;
                height: 45px;
                font-size: 20px;
                margin-left: 5px;
            }

            .game-header {
                padding: 8px 15px;
                gap: 15px;
                font-size: 12px;
            }

            .touch-control-area {
                height: 120px;
            }

            .touch-control-area::before {
                font-size: 10px;
                top: 5px;
            }
        }



        .score-item {
            text-align: center;
            font-size: 12px;
        }

        .score-value {
            font-size: 18px;
            font-weight: bold;
            display: block;
        }

        .basket {
            position: absolute;
            bottom: 30px;
            width: 110px;
            height: 75px;
            background: linear-gradient(145deg, #8B4513, #D2691E, #CD853F);
            border-radius: 20px 20px 60% 60%;
            border: 3px solid #654321;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            cursor: pointer;
            transition: left 0.05s ease-out;
            box-shadow:
                0 10px 25px rgba(0,0,0,0.7),
                inset 0 3px 15px rgba(255,255,255,0.4),
                0 0 40px rgba(255, 215, 0, 0.6);
            animation: basketGlow 3s ease-in-out infinite;
            overflow: hidden;
            /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù„Ù…Ø³ */
            touch-action: none;
            user-select: none;
        }

        .basket::before {
            content: '';
            position: absolute;
            top: -15px;
            left: 10px;
            right: 10px;
            height: 25px;
            background: linear-gradient(145deg, #F4A460, #DEB887, #CD853F);
            border-radius: 15px 15px 0 0;
            border: 2px solid #8B4513;
            box-shadow: inset 0 2px 5px rgba(255,255,255,0.4);
        }

        .basket::after {
            content: '';
            position: absolute;
            top: -8px;
            left: 15px;
            right: 15px;
            height: 12px;
            background: linear-gradient(90deg, #8B4513, #654321, #8B4513);
            border-radius: 8px;
            opacity: 0.8;
        }

        @keyframes basketGlow {
            0% { box-shadow: 0 8px 20px rgba(0,0,0,0.6), inset 0 2px 10px rgba(255,255,255,0.3), 0 0 30px rgba(210, 180, 140, 0.4); }
            50% { box-shadow: 0 10px 25px rgba(0,0,0,0.7), inset 0 3px 15px rgba(255,255,255,0.4), 0 0 40px rgba(255, 215, 0, 0.6); }
            100% { box-shadow: 0 8px 20px rgba(0,0,0,0.6), inset 0 2px 10px rgba(255,255,255,0.3), 0 0 30px rgba(210, 180, 140, 0.4); }
        }

        .game-item {
            position: absolute;
            font-size: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            user-select: none;
            pointer-events: none;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: itemEntry 0.5s ease-out;
            /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
            will-change: transform;
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        @keyframes itemEntry {
            0% { 
                transform: scale(0) rotate(180deg); 
                opacity: 0; 
            }
            50% { 
                transform: scale(1.2) rotate(90deg); 
                opacity: 0.7; 
            }
            100% { 
                transform: scale(1) rotate(0deg); 
                opacity: 1; 
            }
        }

        .fruit {
            width: 55px;
            height: 55px;
            animation: fruitFloat 2s ease-in-out infinite alternate;
        }

        @keyframes fruitFloat {
            0% { transform: translateY(0px) rotate(0deg); }
            100% { transform: translateY(-10px) rotate(10deg); }
        }

        .bad-fruit {
            width: 55px;
            height: 55px;
            animation: wobble 0.5s ease-in-out infinite alternate;
        }

        .bomb {
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, #ff4757, #2f1b14);
            border-radius: 50%;
            border: 2px solid #333;
            animation: bombPulse 1s ease-in-out infinite;
        }

        .combo-basket {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #ffd700, #ff8c00);
            border-radius: 50%;
            border: 3px solid #b8860b;
            animation: goldSpin 2s linear infinite;
        }

        .fruit-salad {
            width: 65px;
            height: 65px;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4, #45b7d1, #f9ca24);
            border-radius: 50%;
            border: 3px solid #fff;
            animation: rainbowPulse 1.5s ease-in-out infinite;
        }

        .gift-trap {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #e74c3c, #c0392b, #8e44ad);
            border-radius: 15px;
            border: 3px solid #2c3e50;
            animation: trapPulse 2s ease-in-out infinite;
            position: relative;
            box-shadow:
                0 0 20px rgba(231, 76, 60, 0.6),
                inset 0 2px 10px rgba(255,255,255,0.2);
        }

        .gift-trap::before {
            content: 'âš ï¸';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 12px;
            background: #f39c12;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: warningBlink 1s ease-in-out infinite;
        }

        @keyframes wobble {
            0% { transform: rotate(-3deg); }
            100% { transform: rotate(3deg); }
        }

        @keyframes bombPulse {
            0% { transform: scale(1); box-shadow: 0 0 5px #ff4757; }
            50% { transform: scale(1.1); box-shadow: 0 0 15px #ff4757; }
            100% { transform: scale(1); box-shadow: 0 0 5px #ff4757; }
        }

        @keyframes goldSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes rainbowPulse {
            0% { transform: scale(1); filter: hue-rotate(0deg); }
            50% { transform: scale(1.1); filter: hue-rotate(180deg); }
            100% { transform: scale(1); filter: hue-rotate(360deg); }
        }

        @keyframes trapPulse {
            0% {
                transform: scale(1) rotate(0deg);
                box-shadow: 0 0 20px rgba(231, 76, 60, 0.6);
            }
            25% {
                transform: scale(1.05) rotate(2deg);
                box-shadow: 0 0 25px rgba(231, 76, 60, 0.8);
            }
            50% {
                transform: scale(1.1) rotate(0deg);
                box-shadow: 0 0 30px rgba(231, 76, 60, 1);
            }
            75% {
                transform: scale(1.05) rotate(-2deg);
                box-shadow: 0 0 25px rgba(231, 76, 60, 0.8);
            }
            100% {
                transform: scale(1) rotate(0deg);
                box-shadow: 0 0 20px rgba(231, 76, 60, 0.6);
            }
        }

        @keyframes warningBlink {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }

        .mystery-box, .mystery-gift, .mystery-mail {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, #f39c12, #e67e22, #d35400);
            border-radius: 10px;
            border: 3px solid #8e44ad;
            animation: mysteryFloat 3s ease-in-out infinite;
            position: relative;
            box-shadow:
                0 0 15px rgba(243, 156, 18, 0.6),
                inset 0 2px 8px rgba(255,255,255,0.3);
        }

        .mystery-box::before, .mystery-gift::before, .mystery-mail::before {
            content: '?';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
            font-weight: bold;
            color: #8e44ad;
            animation: questionMark 2s ease-in-out infinite;
        }

        @keyframes mysteryFloat {
            0% {
                transform: translateY(0px) rotate(0deg);
                box-shadow: 0 0 15px rgba(243, 156, 18, 0.6);
            }
            33% {
                transform: translateY(-8px) rotate(5deg);
                box-shadow: 0 0 20px rgba(243, 156, 18, 0.8);
            }
            66% {
                transform: translateY(-5px) rotate(-3deg);
                box-shadow: 0 0 25px rgba(243, 156, 18, 1);
            }
            100% {
                transform: translateY(0px) rotate(0deg);
                box-shadow: 0 0 15px rgba(243, 156, 18, 0.6);
            }
        }

        @keyframes questionMark {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        /* Ø§Ù„ÙƒÙ†ÙˆØ² */
        .diamond, .crystal, .gold-bag {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            border: 2px solid #fff;
            animation: treasureShine 2s ease-in-out infinite;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
        }

        .diamond {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb, #90caf9);
        }

        .crystal {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7, #ce93d8);
        }

        .gold-bag {
            background: linear-gradient(135deg, #fff3e0, #ffcc02, #ff8f00);
        }

        /* Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù†Ø§Ø¯Ø±Ø© */
        .rare-coin, .trophy {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: 3px solid #ffd700;
            animation: rareGlow 3s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        .rare-coin {
            background: linear-gradient(135deg, #ffd700, #ffb300, #ff8f00);
        }

        .trophy {
            background: linear-gradient(135deg, #ffd700, #ffab00, #ff6f00);
            border-radius: 15px;
        }

        /* Ø§Ù„Ù†Ø¬ÙˆÙ… */
        .star, .super-star, .sparkle {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid #fff;
            animation: starTwinkle 1.5s ease-in-out infinite;
            box-shadow: 0 0 12px rgba(255, 255, 255, 0.7);
        }

        .star {
            background: linear-gradient(135deg, #ffd700, #ffeb3b);
        }

        .super-star {
            background: linear-gradient(135deg, #ff9800, #ffc107, #ffeb3b);
            animation: superStarPulse 2s ease-in-out infinite;
        }

        .sparkle {
            background: linear-gradient(135deg, #e1f5fe, #b3e5fc, #81d4fa);
        }

        @keyframes treasureShine {
            0% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.6); }
            50% { box-shadow: 0 0 25px rgba(255, 255, 255, 1); }
            100% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.6); }
        }

        @keyframes rareGlow {
            0% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
            50% { box-shadow: 0 0 35px rgba(255, 215, 0, 1); }
            100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
        }

        @keyframes starTwinkle {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes superStarPulse {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(90deg); }
            50% { transform: scale(1.2) rotate(180deg); }
            75% { transform: scale(1.1) rotate(270deg); }
            100% { transform: scale(1) rotate(360deg); }
        }

        /* Ù…Ø¤Ø«Ø± Ø§Ù„Ù…Ø·Ø± */
        .rain-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 2s ease-in-out;
        }

        .rain-container.active {
            opacity: 1;
        }

        .raindrop {
            position: absolute;
            background: linear-gradient(to bottom, rgba(174, 194, 224, 0.6), rgba(174, 194, 224, 0.3));
            width: 2px;
            border-radius: 0 0 50% 50%;
            animation: rainFall linear infinite;
        }

        @keyframes rainFall {
            0% {
                transform: translateY(-100vh);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh);
                opacity: 0;
            }
        }

        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 2000;
        }

        .game-title {
            font-size: 2.5em;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        .game-instructions {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.1em;
            line-height: 1.6;
            max-width: 600px;
            padding: 0 20px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
            touch-action: manipulation;
            margin: 10px;
        }

        .btn:hover, .btn:active {
            transform: scale(1.05);
        }

        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 2000;
        }

        .game-over h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #ff6b6b;
        }

        .score-popup {
            position: absolute;
            font-weight: bold;
            font-size: 20px;
            pointer-events: none;
            z-index: 150;
            animation: scoreFloat 1.5s ease-out forwards;
        }

        .score-popup.positive {
            color: #4ecdc4;
        }

        .score-popup.negative {
            color: #ff6b6b;
        }

        .score-popup.gold {
            color: #ffd700;
        }

        .score-popup.pearl {
            color: #e0e0e0;
        }

        @keyframes scoreFloat {
            0% { 
                transform: translateY(0) scale(1); 
                opacity: 1; 
            }
            100% { 
                transform: translateY(-80px) scale(1.3); 
                opacity: 0; 
            }
        }

        .mobile-instructions {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 500;
            display: none;
        }

        .mobile-instructions.show {
            display: block;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        @media (max-width: 768px) {
            .game-header {
                top: 3px;
                padding: 4px 8px;
                gap: 8px;
                font-size: 10px;
                flex-wrap: wrap;
            }

            .game-container {
                padding: 5px;
                margin: 2px;
                max-width: 100vw;
                box-sizing: border-box;
            }

            .game-area {
                height: 65vh;
                min-height: 350px;
                margin: 5px 0;
            }

            .basket {
                width: 80px;
                height: 60px;
                bottom: 15px;
                transition: left 0.03s ease-out;
            }

            .basket::before {
                height: 18px;
                top: -12px;
                left: 6px;
                right: 6px;
            }

            .basket::after {
                height: 10px;
                top: -6px;
                left: 10px;
                right: 10px;
            }

            .game-item {
                font-size: 28px;
            }

            .fruit, .bad-fruit {
                width: 35px;
                height: 35px;
            }

            .start-screen {
                padding: 10px;
                margin: 5px;
            }

            .start-screen h1 {
                font-size: 1.3em;
                margin-bottom: 8px;
            }

            .start-screen p {
                font-size: 0.8em;
                margin-bottom: 6px;
            }

            .btn {
                padding: 8px 12px;
                font-size: 0.8em;
                margin: 4px;
                border-radius: 8px;
            }

            .bomb {
                width: 40px;
                height: 40px;
            }

            .combo-basket {
                width: 50px;
                height: 50px;
            }
            
            .fruit-salad {
                width: 70px;
                height: 70px;
            }

            .gift-trap {
                width: 50px;
                height: 50px;
            }

            .mystery-box, .mystery-gift, .mystery-mail {
                width: 45px;
                height: 45px;
            }

            .mystery-box::before, .mystery-gift::before, .mystery-mail::before {
                font-size: 16px;
            }

            .diamond, .crystal, .gold-bag {
                width: 40px;
                height: 40px;
            }

            .rare-coin, .trophy {
                width: 45px;
                height: 45px;
            }

            .star, .super-star, .sparkle {
                width: 35px;
                height: 35px;
            }
        }

        .combo-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 1500;
            animation: comboFlash 1s ease-out forwards;
            pointer-events: none;
        }

        @keyframes comboFlash {
            0% { 
                transform: translate(-50%, -50%) scale(0) rotate(-180deg); 
                opacity: 0; 
                color: #ffd700;
            }
            25% { 
                transform: translate(-50%, -50%) scale(1.5) rotate(-90deg); 
                opacity: 1; 
                color: #ff6b6b;
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.2) rotate(0deg); 
                opacity: 1; 
                color: #4ecdc4;
            }
            75% { 
                transform: translate(-50%, -50%) scale(1.3) rotate(90deg); 
                opacity: 1; 
                color: #a8e6cf;
            }
            100% { 
                transform: translate(-50%, -50%) scale(1) rotate(180deg); 
                opacity: 0; 
                color: #ffd700;
            }
        }

        .screen-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1200;
            animation: flashEffect 0.3s ease-out;
        }

        @keyframes flashEffect {
            0% { background: transparent; }
            50% { background: rgba(255, 255, 255, 0.8); }
            100% { background: transparent; }
        }

        .screen-shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
            20%, 40%, 60%, 80% { transform: translateX(2px); }
        }

        .score-popup.shield {
            color: #4ecdc4 !important;
            text-shadow: 0 0 8px #4ecdc4, 0 0 12px #4ecdc4;
            font-weight: bold;
            background: rgba(78, 205, 196, 0.2);
            border: 2px solid #4ecdc4;
            border-radius: 8px;
            padding: 5px 10px;
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.5);
        }
    </style>
</head>
<body>
    <div class="game-container" id="gameContainer">
        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ -->
        <div id="player-header-container"></div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
        <div class="start-screen" id="startScreen">
            <h1 class="game-title">ğŸ Ù„Ø¹Ø¨Ø© Ù‚Ø·Ù Ø§Ù„ÙÙˆØ§ÙƒÙ‡ Ø§Ù„Ù…Ø·ÙˆØ±Ø© ğŸŠ</h1>
            <div class="game-instructions" id="gameInstructions">
                <p><span id="controlText">Ø­Ø±Ùƒ Ø§Ù„ÙØ£Ø±Ø© Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø³Ù„Ø©</span> ÙˆØ§Ù‚Ø·Ù Ø£ÙƒØ¨Ø± Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„ÙÙˆØ§ÙƒÙ‡!</p>
                <p><strong>Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</strong></p>
                <p>ğŸğŸŠğŸŒğŸ‡ ÙÙˆØ§ÙƒÙ‡ Ø·Ø§Ø²Ø¬Ø© = Ù†Ù‚Ø§Ø· ÙˆØ°Ù‡Ø¨</p>
                <p>ğŸ¤¢ ÙÙˆØ§ÙƒÙ‡ ØªØ§Ù„ÙØ© = ØªÙÙ‚Ø¯Ùƒ Ù†Ù‚Ø§Ø· ÙˆØ°Ù‡Ø¨</p>
                <p>ğŸ’£ Ù‚Ù†Ø§Ø¨Ù„ = ØªØ®ØµÙ… Ù…Ù† Ø¹Ù…Ù„Ø§ØªÙƒ!</p>
                <p>ğŸ Ø³Ù„Ø© ÙÙˆØ§ÙƒÙ‡ = Ù…ÙƒØ§ÙØ£Ø© ÙƒØ¨ÙŠØ±Ø©</p>
                <p>ğŸ¥— Ø³Ù„Ø·Ø© ÙÙˆØ§ÙƒÙ‡ = Ù…ÙƒØ§ÙØ£Ø© Ø¹Ù…Ù„Ø§Ù‚Ø© ÙˆÙ„Ø¤Ù„Ø¤Ø©!</p>
                <p><strong>Ø§Ù„Ø¹Ù…Ù„Ø§Øª:</strong> ğŸª™ Ø°Ù‡Ø¨ Ù„Ù„Ø¹Ø¨ | ğŸ¦ª Ù„Ø¤Ù„Ø¤ Ù„Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø®Ø§ØµØ©</p>
            </div>
            <button class="btn" onclick="enableAudio(); playSound('click'); startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
            <button class="btn" onclick="toggleSound()" id="sound-btn">ğŸ”Š Ø§Ù„ØµÙˆØª</button>
        </div>

        <!-- Ø±Ø£Ø³ Ø§Ù„Ù„Ø¹Ø¨Ø© -->
        <div class="game-header">
            <div class="score-item">
                <span class="score-value" id="score">0</span>
                <span>Ø§Ù„Ù†Ù‚Ø§Ø·</span>
            </div>
            <div class="score-item">
                <span class="score-value" id="level">1</span>
                <span>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</span>
            </div>
            <div class="score-item">
                <span class="score-value" id="combo">0</span>
                <span>ÙƒÙˆÙ…Ø¨Ùˆ</span>
            </div>
            <button class="mute-btn" onclick="toggleMute()" title="ÙƒØªÙ…/Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ… Ø§Ù„ØµÙˆØª" id="muteBtn">
                ğŸ”Š
            </button>
            <button class="home-btn" onclick="console.log('Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© ØªÙ… Ø§Ù„Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡'); goToMainPage();" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
                ğŸ 
            </button>
        </div>



        <!-- Ø§Ù„Ø³Ù„Ø© -->
        <div class="basket" id="basket"></div>

        <!-- Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„Ø¬ÙˆØ§Ù„ -->
        <div class="mobile-instructions" id="mobileInstructions">
            Ø­Ø±Ùƒ Ø¥ØµØ¨Ø¹Ùƒ Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø³Ù„Ø© ğŸ‘†
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© -->
        <div class="game-over" id="gameOver">
            <h2>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!</h2>
            <p>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: <span id="finalScore">0</span></p>
            <p>Ø£Ø¹Ù„Ù‰ ÙƒÙˆÙ…Ø¨Ùˆ: <span id="finalCombo">0</span></p>
            <p>Ø°Ù‡Ø¨ Ù…ÙƒØªØ³Ø¨: <span id="goldEarned">0</span> ğŸª™</p>
            <p>Ù„Ø¤Ù„Ø¤ Ù…ÙƒØªØ³Ø¨: <span id="pearlsEarned">0</span> ğŸ¦ª</p>
            <button class="btn" onclick="restartGame()">Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
            <button class="btn" onclick="goToMainPage()">ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <button class="btn" onclick="goHome()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³ -->
        <div class="touch-control-area"></div>

        <!-- Ù…Ø¤Ø«Ø± Ø§Ù„Ù…Ø·Ø± -->
        <div class="rain-container" id="rainContainer"></div>
    </div>

    <script>
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯
        let audioContext;
        let audioInitialized = false;

        // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                console.log('ğŸ”Š ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª - Ù„Ø¹Ø¨Ø© Ø§Ù„ÙÙˆØ§ÙƒÙ‡');
            } catch (error) {
                console.log('ğŸ”‡ Web Audio API ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…');
                if (window.gameState) gameState.soundEnabled = false;
            }
        }

        // ØªÙØ¹ÙŠÙ„ AudioContext Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ØªÙØ§Ø¹Ù„
        function enableAudio() {
            if (!audioInitialized && audioContext) {
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        audioInitialized = true;
                        console.log('ğŸ”Š ØªÙ… ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª - Ù„Ø¹Ø¨Ø© Ø§Ù„ÙÙˆØ§ÙƒÙ‡');
                        setTimeout(() => playSound('click'), 100);
                    });
                } else {
                    audioInitialized = true;
                    console.log('ğŸ”Š Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª Ø¬Ø§Ù‡Ø² - Ù„Ø¹Ø¨Ø© Ø§Ù„ÙÙˆØ§ÙƒÙ‡');
                }
            }
        }

        // Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØª
        function toggleSound() {
            enableAudio();

            if (window.gameState) {
                gameState.soundEnabled = !gameState.soundEnabled;
                const soundBtn = document.getElementById('sound-btn');

                if (gameState.soundEnabled) {
                    soundBtn.textContent = 'ğŸ”Š Ø§Ù„ØµÙˆØª';
                    soundBtn.style.opacity = '1';
                    setTimeout(() => playSound('click'), 100);
                } else {
                    soundBtn.textContent = 'ğŸ”‡ ØµØ§Ù…Øª';
                    soundBtn.style.opacity = '0.6';
                }

                localStorage.setItem('fruit-catching-sound-enabled', gameState.soundEnabled);
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£ØµÙˆØ§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Web Audio API (Ø³ÙŠØªÙ… ØªÙ‡ÙŠØ¦ØªÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹)
        let audioContextOld;
        
        // ÙˆØ¸Ø§Ø¦Ù Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£ØµÙˆØ§Øª
        function createTone(frequency, duration, type = 'sine') {
            if (!audioContext) return;
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        // Ø£ØµÙˆØ§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        const gameSounds = {
            catchFruit: () => {
                const notes = [523.25, 659.25, 783.99];
                const randomNote = notes[Math.floor(Math.random() * notes.length)];
                createTone(randomNote, 0.2, 'sine');
            },
            catchSpecial: () => {
                // Ù„Ø­Ù† Ø£ÙƒØ«Ø± ØªØ¹Ù‚ÙŠØ¯Ø§Ù‹ Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø®Ø§ØµØ©
                const melody = [659.25, 783.99, 1046.50, 1318.51];
                melody.forEach((note, index) => {
                    setTimeout(() => createTone(note, 0.15, 'triangle'), index * 60);
                });
            },
            catchBad: () => {
                // ØµÙˆØª Ø£ÙƒØ«Ø± Ø¥Ø²Ø¹Ø§Ø¬Ø§Ù‹ Ù„Ù„ÙÙˆØ§ÙƒÙ‡ Ø§Ù„ØªØ§Ù„ÙØ©
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => createTone(220 - i * 50, 0.1, 'sawtooth'), i * 100);
                }
            },
            bomb: () => {
                // Ø§Ù†ÙØ¬Ø§Ø± Ø£ÙƒØ«Ø± Ø¥Ø«Ø§Ø±Ø©
                for (let i = 0; i < 8; i++) {
                    setTimeout(() => {
                        createTone(80 + Math.random() * 300, 0.08, 'square');
                        createTone(150 + Math.random() * 200, 0.06, 'sawtooth');
                    }, i * 30);
                }
            },
            shield_block: () => {
                // ØµÙˆØª Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¯Ø±Ø¹
                for (let i = 0; i < 4; i++) {
                    setTimeout(() => {
                        createTone(440 + i * 110, 0.1, 'triangle');
                        createTone(880 + i * 55, 0.08, 'sine');
                    }, i * 50);
                }
            },
            combo: () => {
                // ÙƒÙˆÙ…Ø¨Ùˆ Ù…Ø«ÙŠØ± Ù…Ø¹ Ø£ØµÙˆØ§Øª Ù…ØªØ¹Ø¯Ø¯Ø©
                const notes = [523.25, 659.25, 783.99, 1046.50, 1318.51]; 
                notes.forEach((note, index) => {
                    setTimeout(() => {
                        createTone(note, 0.12, 'triangle');
                        createTone(note * 1.5, 0.08, 'sine');
                    }, index * 60);
                });
            },
            levelUp: () => {
                // ØªØ±Ù‚ÙŠØ© Ù…Ø³ØªÙˆÙ‰ Ù…Ø¹ ÙØ±Ø­Ø© ÙƒØ¨ÙŠØ±Ø©
                const melody = [523.25, 659.25, 783.99, 1046.50, 1318.51, 1567.98];
                melody.forEach((note, index) => {
                    setTimeout(() => {
                        createTone(note, 0.25, 'sine');
                        createTone(note / 2, 0.15, 'triangle');
                    }, index * 100);
                });
            },
            perfectCatch: () => {
                // ØµÙˆØª Ø®Ø§Øµ Ù„Ù„Ù‚Ø·Ù Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ
                const harmony = [523.25, 659.25, 783.99];
                harmony.forEach(note => {
                    createTone(note, 0.3, 'sine');
                });
            }
        };

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙˆØ§Ù„ÙƒØªÙ… (Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…)
        function playSoundOld(soundName) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØªÙ…
            if (gameState.isMuted) {
                return;
            }

            try {
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                if (gameSounds[soundName]) {
                    gameSounds[soundName]();
                }
            } catch (error) {
                console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:', error);
            }
        }

        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© Ù…Ø«ÙŠØ±Ø©
        function createScreenFlash(color = 'rgba(255, 255, 255, 0.8)') {
            const flash = document.createElement('div');
            flash.className = 'screen-flash';
            flash.style.background = color;
            gameContainer.appendChild(flash);
            
            setTimeout(() => {
                if (flash.parentNode) {
                    flash.parentNode.removeChild(flash);
                }
            }, 300);
        }

        function shakeScreen() {
            gameContainer.classList.add('screen-shake');
            setTimeout(() => {
                gameContainer.classList.remove('screen-shake');
            }, 500);
        }

        function createParticleExplosion(x, y, color = '#ffd700') {
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.style.cssText = `
                    position: absolute;
                    left: ${x}px;
                    top: ${y}px;
                    width: 6px;
                    height: 6px;
                    background: ${color};
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: 200;
                `;
                
                gameContainer.appendChild(particle);
                
                const angle = (i * 45) * Math.PI / 180;
                const distance = 50 + Math.random() * 50;
                const targetX = x + Math.cos(angle) * distance;
                const targetY = y + Math.sin(angle) * distance;
                
                particle.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${targetX - x}px, ${targetY - y}px) scale(0)`, opacity: 0 }
                ], {
                    duration: 800,
                    easing: 'ease-out'
                }).onfinish = () => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                };
            }
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        let gameState = {
            score: 0,
            level: 1,
            combo: 0,
            maxCombo: 0,
            goldCoins: 10000,
            pearls: 10,
            userShield: null, // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯Ø±Ø¹ Ø§Ù„ÙˆØ§Ù‚ÙŠ
            goldEarned: 0,
            pearlsEarned: 0,
            // Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©
            diamondsEarned: 0,
            crystalsEarned: 0,
            rareCoinsEarned: 0,
            trophiesEarned: 0,
            starsEarned: 0,
            superStarsEarned: 0,
            sparklesEarned: 0,
            isPlaying: false,
            gameSpeed: 3000,
            spawnRate: 1800,
            gameItems: [],
            syncInterval: null,
            isMuted: false,
            economySession: null,
            betAmount: 30, // ØªÙƒÙ„ÙØ© Ø§Ù„Ù„Ø¹Ø¨
            soundEnabled: true // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª
        };

        // (ØªÙ… Ù†Ù‚Ù„ Ø¯ÙˆØ§Ù„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ Ø£Ø¹Ù„Ù‰)

        // Ø¯Ø§Ù„Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£ØµÙˆØ§Øª
        function playSound(type) {
            if (!gameState.soundEnabled || !audioContext) return;

            // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙØ¹Ù„Ø§Ù‹
            if (!audioInitialized) {
                enableAudio();
                return;
            }

            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„ØµÙˆØª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø¯Ø«
                switch(type) {
                    case 'click':
                        // ØµÙˆØª Ù†Ù‚Ø±Ø© Ø¹Ø§Ø¯ÙŠØ©
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                        oscillator.type = 'sine';
                        break;

                    case 'catchFruit':
                        // ØµÙˆØª Ø¬Ù…Ø¹ ÙØ§ÙƒÙ‡Ø©
                        oscillator.frequency.setValueAtTime(500, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.2);
                        gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                        oscillator.type = 'triangle';
                        break;

                    case 'catchBad':
                        // ØµÙˆØª Ø¬Ù…Ø¹ Ø¹Ù†ØµØ± Ø³ÙŠØ¡
                        oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.3);
                        gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        oscillator.type = 'sawtooth';
                        break;

                    case 'catchSpecial':
                        // ØµÙˆØª Ø¬Ù…Ø¹ Ø¹Ù†ØµØ± Ø®Ø§Øµ
                        oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.25);
                        gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.25);
                        oscillator.type = 'square';
                        break;

                    case 'bomb':
                        // ØµÙˆØª Ø§Ù†ÙØ¬Ø§Ø±
                        oscillator.frequency.setValueAtTime(150, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(50, audioContext.currentTime + 0.4);
                        gainNode.gain.setValueAtTime(0.6, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                        oscillator.type = 'sawtooth';
                        break;

                    case 'levelUp':
                        // ØµÙˆØª Ø§Ø±ØªÙ‚Ø§Ø¡ Ù…Ø³ØªÙˆÙ‰
                        oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.3);
                        gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        oscillator.type = 'sine';
                        break;

                    case 'gameStart':
                        // ØµÙˆØª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
                        oscillator.frequency.setValueAtTime(330, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(660, audioContext.currentTime + 0.4);
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                        oscillator.type = 'triangle';
                        break;

                    case 'gameEnd':
                        // ØµÙˆØª Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
                        oscillator.frequency.setValueAtTime(660, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(165, audioContext.currentTime + 0.6);
                        gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6);
                        oscillator.type = 'sine';
                        break;

                    default:
                        return;
                }

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.6);

            } catch (error) {
                console.log('ğŸ”‡ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª');
            }
        }

        // (Ø¯Ø§Ù„Ø© toggleSound Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰)

        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª
        function restoreSoundSettings() {
            const savedSetting = localStorage.getItem('fruit-catching-sound-enabled');
            if (savedSetting !== null) {
                gameState.soundEnabled = savedSetting === 'true';
            }

            const soundBtn = document.getElementById('sound-btn');
            if (gameState.soundEnabled) {
                soundBtn.textContent = 'ğŸ”Š Ø§Ù„ØµÙˆØª';
                soundBtn.style.opacity = '1';
            } else {
                soundBtn.textContent = 'ğŸ”‡ ØµØ§Ù…Øª';
                soundBtn.style.opacity = '0.6';
            }
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª
        function showAudioNotice() {
            if (gameState.soundEnabled && !audioInitialized) {
                const notice = document.getElementById('audio-notice');
                if (notice) {
                    notice.style.display = 'block';
                }
            }
        }

        // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª
        function hideAudioNotice() {
            const notice = document.getElementById('audio-notice');
            if (notice) {
                notice.style.display = 'none';
            }
        }

        // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± - Ø¬ÙˆØ§Ø¦Ø² Ø¨Ø§Ù„Ù…Ø¦Ø§Øª ÙˆØ§Ù„Ø¢Ù„Ø§Ù
        const gameElements = {
            fruits: [
                { emoji: 'ğŸ', points: 150, gold: 50, type: 'fruit' },
                { emoji: 'ğŸŠ', points: 200, gold: 75, type: 'fruit' },
                { emoji: 'ğŸŒ', points: 250, gold: 100, type: 'fruit' },
                { emoji: 'ğŸ‡', points: 300, gold: 125, type: 'fruit' }
            ],
            badFruits: [
                { emoji: 'ğŸ¤¢', points: -400, gold: -150, type: 'bad' },
                { emoji: 'ğŸ¦ ', points: -500, gold: -200, type: 'bad' }
            ],
            bombs: [
                { emoji: 'ğŸ’£', type: 'bomb' }
            ],
            special: [
                { emoji: 'ğŸ', points: 1000, gold: 500, type: 'combo-basket' },
                { emoji: 'ğŸ¥—', points: 2000, gold: 800, pearls: 5, type: 'fruit-salad' }
            ],
            traps: [
                { emoji: 'ğŸ€', points: -800, gold: -300, type: 'gift-trap', description: 'Ù‡Ø¯ÙŠØ© Ù…Ù„ØºÙ…Ø©!' }
            ],
            mysteryBoxes: [
                { emoji: 'ğŸ“¦', type: 'mystery-box', description: 'ØµÙ†Ø¯ÙˆÙ‚ Ù…ÙØ§Ø¬Ø¢Øª!' },
                { emoji: 'ğŸ', type: 'mystery-gift', description: 'Ù‡Ø¯ÙŠØ© Ù…ÙØ§Ø¬Ø¢Øª!' },
                { emoji: 'ğŸ“®', type: 'mystery-mail', description: 'ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ø±ÙŠØ¯ Ù…ÙØ§Ø¬Ø¢Øª!' }
            ],
            treasures: [
                { emoji: 'ğŸ’', points: 1500, gold: 750, diamonds: 3, type: 'diamond', description: 'Ø¬ÙˆÙ‡Ø±Ø© Ø«Ù…ÙŠÙ†Ø©!' },
                { emoji: 'ğŸ”®', points: 2000, gold: 1000, crystals: 2, type: 'crystal', description: 'ÙƒØ±ÙŠØ³ØªØ§Ù„ Ø³Ø­Ø±ÙŠ!' },
                { emoji: 'ğŸ’°', points: 1000, gold: 1500, type: 'gold-bag', description: 'ÙƒÙŠØ³ Ø°Ù‡Ø¨!' }
            ],
            rareCurrency: [
                { emoji: 'ğŸª™', points: 3000, gold: 2000, rareCoins: 5, type: 'rare-coin', description: 'Ø¹Ù…Ù„Ø© Ù†Ø§Ø¯Ø±Ø©!' },
                { emoji: 'ğŸ†', points: 5000, gold: 3000, pearls: 10, trophies: 2, type: 'trophy', description: 'ÙƒØ£Ø³ Ø°Ù‡Ø¨ÙŠ!' }
            ],
            stars: [
                { emoji: 'â­', points: 2500, gold: 1200, stars: 3, type: 'star', description: 'Ù†Ø¬Ù…Ø© Ø°Ù‡Ø¨ÙŠØ©!' },
                { emoji: 'ğŸŒŸ', points: 4000, gold: 2000, pearls: 5, superStars: 2, type: 'super-star', description: 'Ù†Ø¬Ù…Ø© Ø®Ø§Ø±Ù‚Ø©!' },
                { emoji: 'âœ¨', points: 1800, gold: 900, sparkles: 4, type: 'sparkle', description: 'Ø¨Ø±ÙŠÙ‚ Ø³Ø­Ø±ÙŠ!' }
            ],
            treasures: [
                { emoji: 'ğŸ’', points: 150, gold: 50, type: 'diamond', description: 'Ø¬ÙˆÙ‡Ø±Ø© Ø«Ù…ÙŠÙ†Ø©!' },
                { emoji: 'ğŸ”®', points: 200, gold: 75, type: 'crystal', description: 'ÙƒØ±ÙŠØ³ØªØ§Ù„ Ø³Ø­Ø±ÙŠ!' },
                { emoji: 'ğŸ’°', points: 100, gold: 100, type: 'gold-bag', description: 'ÙƒÙŠØ³ Ø°Ù‡Ø¨!' }
            ],
            rareCurrency: [
                { emoji: 'ğŸª™', points: 300, gold: 150, type: 'rare-coin', description: 'Ø¹Ù…Ù„Ø© Ù†Ø§Ø¯Ø±Ø©!' },
                { emoji: 'ğŸ†', points: 500, gold: 200, pearls: 2, type: 'trophy', description: 'ÙƒØ£Ø³ Ø°Ù‡Ø¨ÙŠ!' }
            ],
            stars: [
                { emoji: 'â­', points: 250, gold: 80, type: 'star', description: 'Ù†Ø¬Ù…Ø© Ø°Ù‡Ø¨ÙŠØ©!' },
                { emoji: 'ğŸŒŸ', points: 400, gold: 120, pearls: 1, type: 'super-star', description: 'Ù†Ø¬Ù…Ø© Ø®Ø§Ø±Ù‚Ø©!' },
                { emoji: 'âœ¨', points: 180, gold: 60, type: 'sparkle', description: 'Ø¨Ø±ÙŠÙ‚ Ø³Ø­Ø±ÙŠ!' }
            ],
            boobyFruits: [
                { emoji: 'ğŸ', points: -30, gold: -8, type: 'booby-fruit', description: 'ØªÙØ§Ø­Ø© Ù…Ù„ØºÙˆÙ…Ø©!' },
                { emoji: 'ğŸŠ', points: -25, gold: -6, type: 'booby-fruit', description: 'Ø¨Ø±ØªÙ‚Ø§Ù„Ø© Ù…Ù„ØºÙˆÙ…Ø©!' },
                { emoji: 'ğŸŒ', points: -35, gold: -10, type: 'booby-fruit', description: 'Ù…ÙˆØ²Ø© Ù…Ù„ØºÙˆÙ…Ø©!' },
                { emoji: 'ğŸ‡', points: -40, gold: -12, type: 'booby-fruit', description: 'Ø¹Ù†Ø¨ Ù…Ù„ØºÙˆÙ…!' }
            ]
        };

        // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù„Ø¹Ø¨Ø©
        const gameContainer = document.getElementById('gameContainer');
        const basket = document.getElementById('basket');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOver');

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        function updateDisplay() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('combo').textContent = gameState.combo;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
        async function updateCurrencyFromServer() {
            const token = localStorage.getItem('token');
            if (!token) {
                console.log('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù…Ø² Ù…ØµØ§Ø¯Ù‚Ø©');
                return;
            }

            try {
                const response = await fetch('/api/user/currency', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        const data = await response.json();
                        gameState.goldCoins = data.goldCoins || 0;
                        gameState.pearls = data.pearls || 0;
                        updateDisplay();
                        console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                    } else {
                        console.log('Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…');
                    }
                } else {
                    console.log('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:', response.status);
                }
            } catch (error) {
                console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…Ù„Ø§Øª:', error);
            }
        }

        async function updateShieldFromServer() {
            const token = localStorage.getItem('token');
            if (!token) {
                console.log('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù…Ø² Ù…ØµØ§Ø¯Ù‚Ø© Ù„Ù„Ø¯Ø±Ø¹');
                return;
            }

            try {
                const response = await fetch('/api/user', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const userData = await response.json();
                    if (userData.id) {
                        const shieldResponse = await fetch(`/api/profile/shield/${userData.id}`, {
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            }
                        });
                        if (shieldResponse.ok) {
                            const data = await shieldResponse.json();
                            gameState.userShield = data.shield;
                            console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯Ø±Ø¹');
                        } else {
                            console.log('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯Ø±Ø¹:', shieldResponse.status);
                        }
                    }
                } else {
                    console.log('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', response.status);
                }
            } catch (error) {
                console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯Ø±Ø¹:', error);
            }
        }

        // Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø®Ù„ÙÙŠØ© Ù…Ø«ÙŠØ±Ø©
        let backgroundMusic;
        function startBackgroundMusic() {
            // Ù„Ø§ ØªØ´ØºÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØµÙˆØª Ù…ÙƒØªÙˆÙ…
            if (backgroundMusic || gameState.isMuted) return;

            const bassNotes = [130.81, 146.83, 164.81, 174.61]; // C3, D3, E3, F3
            let noteIndex = 0;

            backgroundMusic = setInterval(() => {
                if (!gameState.isPlaying || gameState.isMuted) return;

                const note = bassNotes[noteIndex % bassNotes.length];
                createTone(note, 0.3, 'triangle');
                createTone(note * 2, 0.2, 'sine');

                noteIndex++;
            }, 800);
        }
        
        function stopBackgroundMusic() {
            if (backgroundMusic) {
                clearInterval(backgroundMusic);
                backgroundMusic = null;
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        function startGame() {
            // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }

            startScreen.style.display = 'none';
            gameState.isPlaying = true;

            // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
            playSound('gameStart');
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©
            startBackgroundMusic();
            gameState.score = 0;
            gameState.level = 1;
            gameState.combo = 0;
            gameState.maxCombo = 0;
            gameState.goldEarned = 0;
            gameState.pearlsEarned = 0;
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            gameState.diamondsEarned = 0;
            gameState.crystalsEarned = 0;
            gameState.rareCoinsEarned = 0;
            gameState.trophiesEarned = 0;
            gameState.starsEarned = 0;
            gameState.superStarsEarned = 0;
            gameState.sparklesEarned = 0;
            gameState.gameSpeed = 3000;
            gameState.spawnRate = 1800;
            gameState.gameItems = [];
            
            // ØªØ¹ÙŠÙŠÙ† Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ
            initializeBasketPosition();

            updateDisplay();
            updateCurrencyFromServer();
            updateShieldFromServer();

            // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ© Ù„Ù„Ø¹Ù…Ù„Ø§Øª (ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©)
            if (gameState.syncInterval) {
                clearInterval(gameState.syncInterval);
            }
            gameState.syncInterval = setInterval(() => {
                if (gameState.isPlaying) {
                    syncCurrencyRealTime();
                }
            }, 30000);

            // Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„Ø¬ÙˆØ§Ù„
            if (isMobileDevice()) {
                const instructions = document.getElementById('mobileInstructions');
                instructions.classList.add('show');
                setTimeout(() => {
                    instructions.classList.remove('show');
                }, 4000);
            }

            // Ø¨Ø¯Ø¡ Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø¹Ù†Ø§ØµØ±
            setTimeout(spawnGameItem, 1000);

            // Ø¨Ø¯Ø¡ Ù…Ø¤Ø«Ø± Ø§Ù„Ù…Ø·Ø±
            initializeRain();
        }

        // Ø¥Ù†ØªØ§Ø¬ Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
        function spawnGameItem() {
            if (!gameState.isPlaying) return;

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø³Ù† Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ±
            const item = createGameItemOptimized();
            let itemData;
            let elementClass = 'game-item';

            // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø°ÙƒØ§Ø¡ Ø§Ù„Ø±Ø¨Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø±Ø©
            const rand = Math.random();

            // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙˆØ§Ù„Ù…Ø³ØªÙˆÙ‰
            let fruitChance = Math.max(0.35, 0.55 - (gameState.level * 0.02)); // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙÙˆØ§ÙƒÙ‡ Ù…Ø¹ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
            let badFruitChance = Math.min(0.20, 0.12 + (gameState.level * 0.01)); // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙÙˆØ§ÙƒÙ‡ Ø§Ù„ØªØ§Ù„ÙØ©
            let bombChance = Math.min(0.25, 0.13 + (gameState.level * 0.015)); // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„
            let specialChance = 0.08;
            let trapChance = Math.min(0.12, 0.07 + (gameState.level * 0.005)); // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙØ®Ø§Ø®
            let mysteryChance = 0.05;
            let treasureChance = Math.min(0.08, gameState.level > 3 ? 0.03 + (gameState.level * 0.005) : 0); // Ø§Ù„ÙƒÙ†ÙˆØ² Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 4
            let rareCurrencyChance = Math.min(0.05, gameState.level > 7 ? 0.02 + (gameState.level * 0.003) : 0); // Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù†Ø§Ø¯Ø±Ø© Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 8
            let starChance = Math.min(0.06, gameState.level > 5 ? 0.02 + (gameState.level * 0.004) : 0); // Ø§Ù„Ù†Ø¬ÙˆÙ… Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 6

            // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ
            if (gameState.combo > 10) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ Ø¹Ø§Ù„ÙŠØŒ Ø²ÙŠØ§Ø¯Ø© ÙØ±ØµØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ø§Ø¯Ø±Ø©
                treasureChance += 0.02;
                rareCurrencyChance += 0.01;
                starChance += 0.015;
                specialChance += 0.02;
                fruitChance -= 0.065;
            } else if (gameState.combo < 3) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ Ù…Ù†Ø®ÙØ¶ØŒ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø®Ø·Ø±
                bombChance -= 0.03;
                trapChance -= 0.02;
                mysteryChance += 0.01;
                fruitChance += 0.04;
            }

            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ§Øª
            let currentChance = 0;

            if (rand < (currentChance += fruitChance)) {
                // ÙÙˆØ§ÙƒÙ‡ Ø·Ø¨ÙŠØ¹ÙŠØ©
                itemData = gameElements.fruits[Math.floor(Math.random() * gameElements.fruits.length)];
                elementClass += ' fruit';
            } else if (rand < (currentChance += badFruitChance)) {
                // ÙÙˆØ§ÙƒÙ‡ ØªØ§Ù„ÙØ©
                itemData = gameElements.badFruits[Math.floor(Math.random() * gameElements.badFruits.length)];
                elementClass += ' bad-fruit';
            } else if (rand < (currentChance += bombChance)) {
                // Ù‚Ù†Ø§Ø¨Ù„
                itemData = gameElements.bombs[0];
                elementClass += ' bomb';
            } else if (rand < (currentChance += trapChance)) {
                // Ù‡Ø¯ÙŠØ© Ù…Ù„ØºÙ…Ø© (ÙØ®)
                itemData = gameElements.traps[0];
                elementClass += ' gift-trap';
            } else if (rand < (currentChance += mysteryChance)) {
                // ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…ÙØ§Ø¬Ø¢Øª
                itemData = gameElements.mysteryBoxes[Math.floor(Math.random() * gameElements.mysteryBoxes.length)];
                elementClass += ` ${itemData.type}`;
            } else if (rand < (currentChance += treasureChance)) {
                // Ø§Ù„ÙƒÙ†ÙˆØ² (Ø¬ÙˆØ§Ù‡Ø±ØŒ ÙƒØ±ÙŠØ³ØªØ§Ù„ØŒ ÙƒÙŠØ³ Ø°Ù‡Ø¨)
                itemData = gameElements.treasures[Math.floor(Math.random() * gameElements.treasures.length)];
                elementClass += ` ${itemData.type}`;
            } else if (rand < (currentChance += rareCurrencyChance)) {
                // Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù†Ø§Ø¯Ø±Ø© (Ø¹Ù…Ù„Ø© Ù†Ø§Ø¯Ø±Ø©ØŒ ÙƒØ£Ø³)
                itemData = gameElements.rareCurrency[Math.floor(Math.random() * gameElements.rareCurrency.length)];
                elementClass += ` ${itemData.type}`;
            } else if (rand < (currentChance += starChance)) {
                // Ø§Ù„Ù†Ø¬ÙˆÙ… (Ù†Ø¬Ù…Ø©ØŒ Ù†Ø¬Ù…Ø© Ø®Ø§Ø±Ù‚Ø©ØŒ Ø¨Ø±ÙŠÙ‚)
                itemData = gameElements.stars[Math.floor(Math.random() * gameElements.stars.length)];
                elementClass += ` ${itemData.type}`;
            } else {
                // Ø¹Ù†Ø§ØµØ± Ø®Ø§ØµØ©
                itemData = gameElements.special[Math.floor(Math.random() * gameElements.special.length)];
                elementClass += ` ${itemData.type}`;
            }

            item.className = elementClass;
            if (itemData.emoji) {
                item.textContent = itemData.emoji;
            }

            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù†ØµØ±
            Object.assign(item.dataset, itemData);

            // Ù…ÙˆØ¶Ø¹ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¹Ø¨Ø± Ø§Ù„Ø´Ø§Ø´Ø©
            const itemWidth = window.innerWidth <= 768 ? 45 : 55;
            const maxX = window.innerWidth - itemWidth;
            const randomX = Math.random() * maxX;
            item.style.left = randomX + 'px';
            item.style.top = '-70px'; // Ø§Ø³ØªØ®Ø¯Ø§Ù… top Ù„Ù„Ø¨Ø³Ø§Ø·Ø©

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø´Ø·Ø©
            gameState.gameItems.push(item);

            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¹Ù†ØµØ± Ù„Ø£Ø³ÙÙ„
            animateGameItem(item);

            // Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„ØªØ§Ù„ÙŠ Ù…Ø¹ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø±Ø¹Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
            const baseDelay = 1200;
            const levelSpeedReduction = gameState.level * 80; // ØªÙ‚Ù„ÙŠÙ„ Ø£ÙƒØ¨Ø± Ù„Ù„ØªØ£Ø®ÙŠØ±
            const nextDelay = Math.max(400, baseDelay - levelSpeedReduction); // Ø­Ø¯ Ø£Ø¯Ù†Ù‰ 400ms
            setTimeout(spawnGameItem, nextDelay);
        }

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ø´Ø·Ø© Ù„Ù„ØªÙ†Ø¸ÙŠÙ
        const activeItems = new Set();

        // ØªØ­Ø±ÙŠÙƒ Ø¹Ù†ØµØ± Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø³ÙŠØ·Ø© ÙˆÙØ¹Ø§Ù„Ø©
        function animateGameItem(item) {
            let position = parseInt(item.style.top) || -70;
            activeItems.add(item);

            function animate() {
                if (!gameState.isPlaying || !item.parentNode || !activeItems.has(item)) {
                    activeItems.delete(item);
                    return;
                }

                // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¹Ù†ØµØ± Ù„Ø£Ø³ÙÙ„ Ù…Ø¹ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø±Ø¹Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
                const baseSpeed = 3;
                const levelSpeedBonus = Math.min(4, gameState.level * 0.3); // Ø²ÙŠØ§Ø¯Ø© ØªØ¯Ø±ÙŠØ¬ÙŠØ©
                const totalSpeed = baseSpeed + levelSpeedBonus;

                position += totalSpeed;
                item.style.top = position + 'px';

                // ÙØ­Øµ Ø§Ù„ØªØµØ§Ø¯Ù…
                if (checkCollision(item, basket)) {
                    catchItem(item);
                    activeItems.delete(item);
                    return;
                }

                // Ø¥Ø°Ø§ ÙˆØµÙ„ Ù„Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©
                if (position > window.innerHeight) {
                    if (item.dataset.type === 'fruit') {
                        resetCombo();
                    }
                    removeGameItem(item);
                    activeItems.delete(item);
                    return;
                }

                // Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ø­Ø±ÙƒØ©
                setTimeout(animate, 16); // ~60 FPS
            }

            // Ø¨Ø¯Ø¡ Ø§Ù„Ø­Ø±ÙƒØ©
            animate();
        }

        // ÙØ­Øµ Ø§Ù„ØªØµØ§Ø¯Ù… Ø§Ù„Ø£ØµÙ„ÙŠ (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ)
        function checkCollision(element, basket) {
            const elementRect = element.getBoundingClientRect();
            const basketRect = basket.getBoundingClientRect();

            return elementRect.bottom >= basketRect.top &&
                   elementRect.left < basketRect.right &&
                   elementRect.right > basketRect.left &&
                   elementRect.top < basketRect.bottom;
        }

        // ÙØ­Øµ Ø§Ù„ØªØµØ§Ø¯Ù… Ø§Ù„Ù…Ø­Ø³Ù† Ù„Ù„Ø£Ø¯Ø§Ø¡
        let basketRect = null;
        let basketRectUpdateTime = 0;

        function checkCollisionOptimized(element, basket) {
            const currentTime = performance.now();

            // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ù„Ø© ÙƒÙ„ 100ms ÙÙ‚Ø· Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† ÙƒÙ„ Ø¥Ø·Ø§Ø±
            if (!basketRect || currentTime - basketRectUpdateTime > 100) {
                basketRect = basket.getBoundingClientRect();
                basketRectUpdateTime = currentTime;
            }

            // Ø­Ø³Ø§Ø¨ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ transform
            const elementRect = element.getBoundingClientRect();

            // ÙØ­Øµ Ù…Ø¨Ø³Ø· Ù„Ù„ØªØµØ§Ø¯Ù… Ù…Ø¹ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
            const overlap = 10; // Ù…Ø³Ø§Ø­Ø© ØªØ¯Ø§Ø®Ù„ Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ù‚Ø·Ù
            return elementRect.bottom >= (basketRect.top - overlap) &&
                   elementRect.left < (basketRect.right + overlap) &&
                   elementRect.right > (basketRect.left - overlap) &&
                   elementRect.top < (basketRect.bottom + overlap);
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙÙˆØ±ÙŠØ© Ù„Ù„Ø±ØµÙŠØ¯ Ù„Ù…Ù†Ø¹ Ø§Ù„ØºØ´
        async function syncBalanceRealTime(points, gold, pearls, type) {
            try {
                if (window.gameEconomy && typeof window.gameEconomy.updatePlayerBalance === 'function') {
                    // Ø¥Ù†Ø´Ø§Ø¡ Ù†ØªÙŠØ¬Ø© Ù…Ø¤Ù‚ØªØ© Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„ÙˆØ§Ø­Ø¯
                    const tempResult = {
                        isWin: points > 0 && gold > 0,
                        winAmount: Math.max(0, gold),
                        lossAmount: Math.max(0, -gold),
                        playerScore: gameState.score,
                        skillFactor: gameState.combo / 10 + 1.0,
                        economicFactor: 1.0,
                        probability: type === 'fruit' ? 0.8 : (type === 'bad' ? 0.2 : 0.5),
                        realTimeSync: true // Ø¹Ù„Ø§Ù…Ø© Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙÙˆØ±ÙŠØ©
                    };

                    const balanceUpdate = await window.gameEconomy.updatePlayerBalance(tempResult);
                    if (balanceUpdate && balanceUpdate.success) {
                        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø±ØµÙŠØ¯ ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± ÙÙˆØ±ÙŠØ§Ù‹
                        if (window.playerHeader && typeof window.playerHeader.updateBalance === 'function') {
                            window.playerHeader.updateBalance(balanceUpdate.newBalance);
                        }

                        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
                        console.log(`ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ©: ${gold > 0 ? '+' : ''}${gold} Ø°Ù‡Ø¨ | Ø±ØµÙŠØ¯ Ø¬Ø¯ÙŠØ¯: ${balanceUpdate.newBalance}`);
                    }
                }
            } catch (error) {
                // ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©ØŒ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ù…Ù†Ø¹ Ø§Ù„ØºØ´
                console.error('âš ï¸ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙÙˆØ±ÙŠØ© - Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø©');
                gameState.isPlaying = false;
                clearInterval(gameState.gameTimer);
                clearInterval(gameState.spawnTimer);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù…Ø§Ù†.');
            }
        }

        // Ù‚Ø·Ù Ø¹Ù†ØµØ±
        async function catchItem(item) {
            const type = item.dataset.type;
            const points = parseInt(item.dataset.points) || 0;
            const gold = parseInt(item.dataset.gold) || 0;
            const pearls = parseInt(item.dataset.pearls) || 0;

            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            const diamonds = parseInt(item.dataset.diamonds) || 0;
            const crystals = parseInt(item.dataset.crystals) || 0;
            const rareCoins = parseInt(item.dataset.rareCoins) || 0;
            const trophies = parseInt(item.dataset.trophies) || 0;
            const stars = parseInt(item.dataset.stars) || 0;
            const superStars = parseInt(item.dataset.superStars) || 0;
            const sparkles = parseInt(item.dataset.sparkles) || 0;
            
            if (type === 'bomb') {
                // Ø®ØµÙ… Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø¹Ù†Ø¯ Ù‚Ø·Ù Ù‚Ù†Ø¨Ù„Ø©
                const goldLoss = Math.min(gameState.goldCoins, 50 + (gameState.level * 10)); // Ø®Ø³Ø§Ø±Ø© Ù…ØªØ²Ø§ÙŠØ¯Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
                const pearlLoss = gameState.pearls > 0 ? 1 : 0; // Ø®Ø³Ø§Ø±Ø© Ù„Ø¤Ù„Ø¤Ø© ÙˆØ§Ø­Ø¯Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª

                gameState.goldEarned -= goldLoss;
                gameState.pearlsEarned -= pearlLoss;

                resetCombo();

                playSound('bomb');

                // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù†ÙØ¬Ø§Ø± Ù…Ø«ÙŠØ±Ø© Ù„Ù„Ù‚Ù†Ø§Ø¨Ù„
                const rect = item.getBoundingClientRect();
                createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#ff4757');
                createScreenFlash('rgba(255, 71, 87, 0.7)');
                shakeScreen();

                // Ø§Ù†ÙØ¬Ø§Ø± Ø«Ø§Ù†ÙˆÛŒ Ø£ÙƒØ¨Ø±
                setTimeout(() => {
                    createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#ffa502');
                }, 200);

                showScorePopup(item, `-${goldLoss} ğŸª™`, 'negative');
                if (pearlLoss > 0) {
                    showScorePopup(item, `-${pearlLoss} ğŸ¦ª`, 'negative', 30);
                }
                showComboIndicator('Ø§Ù†ÙØ¬Ø§Ø±! ğŸ’¥');

                removeGameItem(item);
                updateDisplay();
                return;
            }

            if (type === 'gift-trap') {
                // Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„Ù…Ù„ØºÙ…Ø© - ÙØ® Ø®Ø§Ø¯Ø¹!
                const goldLoss = Math.min(gameState.goldCoins, 15 + (gameState.level * 5));

                gameState.goldEarned -= goldLoss;
                gameState.score += points; // Ù†Ù‚Ø§Ø· Ø³Ø§Ù„Ø¨Ø©

                // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†Ù‡
                gameState.combo = Math.max(0, gameState.combo - 3);

                playSound('bomb'); // Ù†ÙØ³ ØµÙˆØª Ø§Ù„Ù‚Ù†Ø¨Ù„Ø©

                // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© Ù…Ù…ÙŠØ²Ø© Ù„Ù„ÙØ®
                const rect = item.getBoundingClientRect();
                createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#e74c3c');
                createScreenFlash('rgba(231, 76, 60, 0.5)');

                // ØªØ£Ø«ÙŠØ± Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„Ø®Ø¯Ø§Ø¹
                setTimeout(() => {
                    createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#8e44ad');
                }, 150);

                showScorePopup(item, `ÙØ®! -${goldLoss} ğŸª™`, 'negative');
                showComboIndicator('Ù‡Ø¯ÙŠØ© Ù…Ù„ØºÙ…Ø©! ğŸ€ğŸ’¥');

                removeGameItem(item);
                updateDisplay();
                return;
            }

            if (type === 'mystery-box' || type === 'mystery-gift' || type === 'mystery-mail') {
                // ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…ÙØ§Ø¬Ø¢Øª - Ù…ÙƒØ§ÙØ£Ø© Ø£Ùˆ Ø®Ø³Ø§Ø±Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©!
                const surpriseRand = Math.random();
                const rect = item.getBoundingClientRect();

                // 60% Ù…ÙƒØ§ÙØ£Ø©ØŒ 40% Ø®Ø³Ø§Ø±Ø©
                if (surpriseRand < 0.6) {
                    // Ù…ÙƒØ§ÙØ£Ø©! ğŸ‰
                    const bonusPoints = 50 + Math.floor(Math.random() * 100); // 50-150 Ù†Ù‚Ø·Ø©
                    const bonusGold = 10 + Math.floor(Math.random() * 20); // 10-30 Ø°Ù‡Ø¨
                    const bonusPearls = Math.random() < 0.3 ? 1 : 0; // 30% ÙØ±ØµØ© Ù„Ù„Ø¤Ù„Ø¤Ø©

                    gameState.score += bonusPoints;
                    gameState.goldEarned += bonusGold;
                    if (bonusPearls > 0) {
                        gameState.pearlsEarned += bonusPearls;
                    }
                    gameState.combo += 2; // Ù…ÙƒØ§ÙØ£Ø© ÙƒÙˆÙ…Ø¨Ùˆ

                    playSound('special');

                    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© Ù„Ù„Ù…ÙƒØ§ÙØ£Ø©
                    createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#f39c12');
                    createScreenFlash('rgba(243, 156, 18, 0.4)');

                    setTimeout(() => {
                        createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#27ae60');
                    }, 100);

                    showScorePopup(item, `+${bonusPoints} ğŸ¯`, 'positive');
                    showScorePopup(item, `+${bonusGold} ğŸª™`, 'positive', 25);
                    if (bonusPearls > 0) {
                        showScorePopup(item, `+${bonusPearls} ğŸ¦ª`, 'pearl', 50);
                    }
                    showComboIndicator('Ù…ÙØ§Ø¬Ø£Ø© Ø±Ø§Ø¦Ø¹Ø©! ğŸ“¦âœ¨');

                } else {
                    // Ø®Ø³Ø§Ø±Ø©! ğŸ˜±
                    const lossPoints = 20 + Math.floor(Math.random() * 40); // 20-60 Ù†Ù‚Ø·Ø©
                    const lossGold = 5 + Math.floor(Math.random() * 15); // 5-20 Ø°Ù‡Ø¨

                    gameState.score -= lossPoints;
                    gameState.goldEarned -= lossGold;
                    gameState.combo = Math.max(0, gameState.combo - 1); // ØªÙ‚Ù„ÙŠÙ„ ÙƒÙˆÙ…Ø¨Ùˆ Ù‚Ù„ÙŠÙ„

                    playSound('bomb');

                    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© Ù„Ù„Ø®Ø³Ø§Ø±Ø©
                    createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#e74c3c');
                    createScreenFlash('rgba(231, 76, 60, 0.3)');

                    showScorePopup(item, `-${lossPoints} ğŸ¯`, 'negative');
                    showScorePopup(item, `-${lossGold} ğŸª™`, 'negative', 25);
                    showComboIndicator('Ù…ÙØ§Ø¬Ø£Ø© Ø³ÙŠØ¦Ø©! ğŸ“¦ğŸ’¥');
                }

                removeGameItem(item);
                updateDisplay();
                return;
            }
            
            if (type === 'fruit') {
                gameState.combo++;
                const totalPoints = points + (gameState.combo * 5);
                const totalGold = gold + Math.floor(gameState.combo / 3);

                gameState.score += totalPoints;
                gameState.goldEarned += totalGold;

                // Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ© Ù…Ø¹ Ø§Ù„Ø±ØµÙŠØ¯
                await syncBalanceRealTime(totalPoints, totalGold, 0, type);

                playSound('catchFruit');
                
                // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© Ù…Ø«ÙŠØ±Ø© Ù„Ù„ÙÙˆØ§ÙƒÙ‡
                const rect = item.getBoundingClientRect();
                createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#4ecdc4');
                
                if (gameState.combo % 3 === 0) {
                    playSound('perfectCatch');
                    createScreenFlash('rgba(76, 205, 196, 0.4)');
                }
                
                showScorePopup(item, `+${points + (gameState.combo * 5)}`, 'positive');
                showScorePopup(item, `+${gold + Math.floor(gameState.combo / 3)} ğŸª™`, 'gold', 30);
                
                if (gameState.combo > 1 && gameState.combo % 5 === 0) {
                    playSound('combo');
                    createScreenFlash('rgba(255, 215, 0, 0.6)');
                    shakeScreen();
                    
                    // Ø±Ø³Ø§Ø¦Ù„ ØªØ´Ø¬ÙŠØ¹ÙŠØ© Ø­Ù…Ø§Ø³ÙŠØ©
                    const messages = [
                        `ÙƒÙˆÙ…Ø¨Ùˆ ${gameState.combo}! ğŸ”¥`, 
                        `Ø±Ø§Ø¦Ø¹! ${gameState.combo} Ù…ØªØªØ§Ù„ÙŠØ©! âš¡`, 
                        `Ù„Ø§ ØªØªÙˆÙ‚Ù! ${gameState.combo}! ğŸ’ª`,
                        `Ù…Ø°Ù‡Ù„! ${gameState.combo} ÙƒÙˆÙ…Ø¨Ùˆ! ğŸŒŸ`
                    ];
                    const message = messages[Math.floor(Math.random() * messages.length)];
                    showComboIndicator(message);
                }
            } else if (type === 'bad') {
                gameState.score = Math.max(0, gameState.score + points);
                gameState.goldEarned = Math.max(-gameState.goldCoins, gameState.goldEarned + gold);
                resetCombo();

                // Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ© Ù…Ø¹ Ø§Ù„Ø±ØµÙŠØ¯ (Ø®Ø³Ø§Ø±Ø©)
                await syncBalanceRealTime(points, gold, 0, type);

                playSound('catchBad');
                
                // ØªØ£Ø«ÙŠØ±Ø§Øª Ø³Ù„Ø¨ÙŠØ© Ù„Ù„ÙÙˆØ§ÙƒÙ‡ Ø§Ù„ØªØ§Ù„ÙØ©
                const rect = item.getBoundingClientRect();
                createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#ff6b6b');
                createScreenFlash('rgba(255, 107, 107, 0.3)');
                
                showScorePopup(item, `${points}`, 'negative');
                showScorePopup(item, `${gold} ğŸª™`, 'negative', 30);
            } else if (type === 'combo-basket') {
                const bonusPoints = points + (gameState.combo * 10);
                const bonusGold = gold + (gameState.combo * 2);
                
                gameState.score += bonusPoints;
                gameState.goldEarned += bonusGold;
                gameState.combo += 3;
                
                playSound('catchSpecial');
                
                // ØªØ£Ø«ÙŠØ±Ø§Øª Ù…Ø°Ù‡Ù„Ø© Ù„Ù„Ø³Ù„Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©
                const rect = item.getBoundingClientRect();
                createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#ffd700');
                createScreenFlash('rgba(255, 215, 0, 0.5)');
                
                showScorePopup(item, `+${bonusPoints}`, 'positive');
                showScorePopup(item, `+${bonusGold} ğŸª™`, 'gold', 30);
                showComboIndicator('Ø³Ù„Ø© ÙÙˆØ§ÙƒÙ‡! âœ¨');
            } else if (type === 'fruit-salad') {
                const bonusPoints = points + (gameState.combo * 15);
                const bonusGold = gold + (gameState.combo * 3);
                
                gameState.score += bonusPoints;
                gameState.goldEarned += bonusGold;
                gameState.pearlsEarned += pearls;
                gameState.combo += 5;
                
                playSound('catchSpecial');
                setTimeout(() => playSound('combo'), 300);
                
                // ØªØ£Ø«ÙŠØ±Ø§Øª Ù‚ÙˆØ³ Ù‚Ø²Ø­ Ù„Ù„Ø³Ù„Ø·Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø©
                const rect = item.getBoundingClientRect();
                createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#ff6b6b');
                setTimeout(() => createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#4ecdc4'), 100);
                setTimeout(() => createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#ffd700'), 200);
                createScreenFlash('rgba(255, 255, 255, 0.8)');
                shakeScreen();
                
                showScorePopup(item, `+${bonusPoints}`, 'positive');
                showScorePopup(item, `+${bonusGold} ğŸª™`, 'gold', 30);
                showScorePopup(item, `+${pearls} ğŸ¦ª`, 'pearl', 60);
                showComboIndicator('Ø³Ù„Ø·Ø© ÙÙˆØ§ÙƒÙ‡ Ø±Ø§Ø¦Ø¹Ø©! ğŸŒˆ');
            } else if (type === 'diamond' || type === 'crystal' || type === 'gold-bag') {
                // Ø§Ù„ÙƒÙ†ÙˆØ²
                gameState.score += points;
                gameState.goldEarned += gold;
                gameState.combo += 1;

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù„Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                if (type === 'diamond' && diamonds > 0) {
                    gameState.diamondsEarned += diamonds;
                    showScorePopup(item, `+${diamonds} ğŸ’`, 'treasure', 60);
                } else if (type === 'crystal' && crystals > 0) {
                    gameState.crystalsEarned += crystals;
                    showScorePopup(item, `+${crystals} ğŸ”®`, 'treasure', 60);
                }

                playSound('catchSpecial');

                const rect = item.getBoundingClientRect();
                createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#e74c3c');
                createScreenFlash('rgba(231, 76, 60, 0.4)');

                showScorePopup(item, `+${points} ğŸ¯`, 'positive');
                showScorePopup(item, `+${gold} ğŸª™`, 'gold', 30);
                showComboIndicator('ÙƒÙ†Ø² Ø«Ù…ÙŠÙ†! âœ¨');

            } else if (type === 'rare-coin' || type === 'trophy') {
                // Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù†Ø§Ø¯Ø±Ø©
                gameState.score += points;
                gameState.goldEarned += gold;
                if (pearls > 0) gameState.pearlsEarned += pearls;
                gameState.combo += 2;

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù„Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                if (type === 'rare-coin' && rareCoins > 0) {
                    gameState.rareCoinsEarned += rareCoins;
                    showScorePopup(item, `+${rareCoins} ğŸª™`, 'rare', 60);
                } else if (type === 'trophy' && trophies > 0) {
                    gameState.trophiesEarned += trophies;
                    showScorePopup(item, `+${trophies} ğŸ†`, 'rare', 60);
                }

                playSound('catchSpecial');
                setTimeout(() => playSound('combo'), 200);

                const rect = item.getBoundingClientRect();
                createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#f39c12');
                createScreenFlash('rgba(243, 156, 18, 0.6)');

                showScorePopup(item, `+${points} ğŸ¯`, 'positive');
                showScorePopup(item, `+${gold} ğŸª™`, 'gold', 30);
                if (pearls > 0) showScorePopup(item, `+${pearls} ğŸ¦ª`, 'pearl', 90);
                showComboIndicator('Ø¹Ù…Ù„Ø© Ù†Ø§Ø¯Ø±Ø©! ğŸ’°');

            } else if (type === 'star' || type === 'super-star' || type === 'sparkle') {
                // Ø§Ù„Ù†Ø¬ÙˆÙ…
                gameState.score += points;
                gameState.goldEarned += gold;
                if (pearls > 0) gameState.pearlsEarned += pearls;
                gameState.combo += 1;

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù„Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                if (type === 'star' && stars > 0) {
                    gameState.starsEarned += stars;
                    showScorePopup(item, `+${stars} â­`, 'star', 60);
                } else if (type === 'super-star' && superStars > 0) {
                    gameState.superStarsEarned += superStars;
                    showScorePopup(item, `+${superStars} ğŸŒŸ`, 'star', 60);
                } else if (type === 'sparkle' && sparkles > 0) {
                    gameState.sparklesEarned += sparkles;
                    showScorePopup(item, `+${sparkles} âœ¨`, 'star', 60);
                }

                playSound('catchSpecial');

                const rect = item.getBoundingClientRect();
                createParticleExplosion(rect.left + rect.width/2, rect.top + rect.height/2, '#ffd700');
                createScreenFlash('rgba(255, 215, 0, 0.5)');

                showScorePopup(item, `+${points} ğŸ¯`, 'positive');
                showScorePopup(item, `+${gold} ğŸª™`, 'gold', 30);
                if (pearls > 0) showScorePopup(item, `+${pearls} ğŸ¦ª`, 'pearl', 90);
                showComboIndicator('Ù†Ø¬Ù…Ø© Ø±Ø§Ø¦Ø¹Ø©! â­');
            }

            gameState.maxCombo = Math.max(gameState.maxCombo, gameState.combo);
            removeGameItem(item);
            updateDisplay();
            checkLevelUp();
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ
        function resetCombo() {
            if (gameState.combo > 0) {
                gameState.combo = 0;
                updateDisplay();
            }
        }

        // ØªØ­Ø³ÙŠÙ† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± - Ø§Ø³ØªØ®Ø¯Ø§Ù… object pool Ù„ØªÙ‚Ù„ÙŠÙ„ garbage collection
        const itemPool = [];
        const maxPoolSize = 20;

        // Ø¥Ø²Ø§Ù„Ø© Ø¹Ù†ØµØ± Ù…Ø¹ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
        function removeGameItem(item) {
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø±ÙƒØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù†Ø´Ø·Ø©
            activeItems.delete(item);

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø­Ø°ÙÙ‡ Ù…Ø¨Ø§Ø´Ø±Ø©
            item.style.display = 'none';
            item.style.top = '-70px';

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯ ØªØ¯ÙˆÙŠØ±Ù‡Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø³Ø§Ø­Ø©
            if (itemPool.length < maxPoolSize) {
                // ØªÙ†Ø¸ÙŠÙ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø¹Ù†ØµØ±
                item.dataset.type = '';
                item.dataset.points = '';
                item.dataset.gold = '';
                item.dataset.pearls = '';
                item.className = 'game-item';
                itemPool.push(item);
            } else {
                // Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù…ØªÙ„Ø¦Ø©
                if (item.parentNode) {
                    item.parentNode.removeChild(item);
                }
            }

            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ø´Ø·Ø©
            gameState.gameItems = gameState.gameItems.filter(i => i !== item);
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
        function createGameItemOptimized() {
            let item;

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ù†ØµØ± Ù…Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯ ØªØ¯ÙˆÙŠØ±Ù‡Ø§ Ø¥Ù† ÙˆØ¬Ø¯
            if (itemPool.length > 0) {
                item = itemPool.pop();
                item.style.display = 'block';
            } else {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯ ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø¹Ù†Ø§ØµØ± Ù…Ø¹Ø§Ø¯ ØªØ¯ÙˆÙŠØ±Ù‡Ø§
                item = document.createElement('div');
                item.className = 'game-item';
                gameContainer.appendChild(item);
            }

            return item;
        }

        // Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø± Ø§Ù„Ù†Ù‚Ø§Ø·
        function showScorePopup(element, text, type, offsetY = 0) {
            const popup = document.createElement('div');
            popup.className = `score-popup ${type}`;
            popup.textContent = text;
            
            const rect = element.getBoundingClientRect();
            popup.style.left = rect.left + rect.width/2 + 'px';
            popup.style.top = rect.top - offsetY + 'px';
            
            gameContainer.appendChild(popup);
            
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.parentNode.removeChild(popup);
                }
            }, 1500);
        }

        // Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ
        function showComboIndicator(text) {
            const indicator = document.createElement('div');
            indicator.className = 'combo-indicator';
            indicator.textContent = text;
            
            gameContainer.appendChild(indicator);
            
            setTimeout(() => {
                if (indicator.parentNode) {
                    indicator.parentNode.removeChild(indicator);
                }
            }, 1000);
        }

        // ÙØ­Øµ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ
        function checkLevelUp() {
            const newLevel = Math.floor(gameState.score / 500) + 1;
            if (newLevel > gameState.level) {
                gameState.level = newLevel;
                gameState.gameSpeed = Math.max(1500, gameState.gameSpeed - 150);
                gameState.spawnRate = Math.max(1000, gameState.spawnRate - 100);
                
                playSound('levelUp');
                
                // ØªØ£Ø«ÙŠØ±Ø§Øª ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø°Ù‡Ù„Ø©
                createScreenFlash('rgba(255, 215, 0, 0.9)');
                shakeScreen();
                
                // Ø§Ù†ÙØ¬Ø§Ø±Ø§Øª Ø°Ù‡Ø¨ÙŠØ© Ù…ØªØ¹Ø¯Ø¯Ø©
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                createParticleExplosion(centerX, centerY, '#ffd700');
                setTimeout(() => createParticleExplosion(centerX - 100, centerY - 50, '#ff6b6b'), 200);
                setTimeout(() => createParticleExplosion(centerX + 100, centerY - 50, '#4ecdc4'), 400);
                
                showComboIndicator(`ğŸ‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${newLevel}! ğŸ‰`);
                updateDisplay();
            }
        }

        // Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ø¹ ØªÙ†Ø¸ÙŠÙ Ù…Ø­Ø³Ù† Ù„Ù„Ø°Ø§ÙƒØ±Ø©
        function endGame() {
            gameState.isPlaying = false;

            // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
            playSound('gameEnd');

            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©
            stopBackgroundMusic();

            // Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ø«Ø± Ø§Ù„Ù…Ø·Ø±
            stopAllRain();

            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ©
            if (gameState.syncInterval) {
                clearInterval(gameState.syncInterval);
                gameState.syncInterval = null;
            }

            // ØªÙ†Ø¸ÙŠÙ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©
            activeItems.clear();

            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø´Ø§Ø´Ø©
            gameState.gameItems.forEach(item => removeGameItem(item));
            gameState.gameItems = [];

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† cache ÙØ­Øµ Ø§Ù„ØªØµØ§Ø¯Ù…
            basketRect = null;
            basketRectUpdateTime = 0;

            // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('finalCombo').textContent = gameState.maxCombo;
            document.getElementById('goldEarned').textContent = gameState.goldEarned;
            document.getElementById('pearlsEarned').textContent = gameState.pearlsEarned;
            gameOverScreen.style.display = 'block';

            // Ø­ÙØ¸ Ø§Ù„Ù†Ù‚Ø·Ø© ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Øª
            saveGameResults();
        }

        // Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        function restartGame() {
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
            stopBackgroundMusic();
            gameOverScreen.style.display = 'none';
            startGame();
        }

        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© (Ù…Ù† Ø´Ø§Ø´Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©)
        function goHome() {
            window.close();
        }

        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨) - Ù…Ø¨Ø³Ø·Ø© ÙˆÙ…ÙˆØ«ÙˆÙ‚Ø©
        function goToMainPage() {
            console.log('ğŸ  ØªÙ… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø©');

            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø© ÙÙˆØ±Ø§Ù‹
            gameState.isPlaying = false;

            // ØªÙ†Ø¸ÙŠÙ Ø³Ø±ÙŠØ¹
            try {
                if (gameState.syncInterval) {
                    clearInterval(gameState.syncInterval);
                }
                if (activeItems) {
                    activeItems.clear();
                }
            } catch (e) {
                console.log('ØªÙ†Ø¸ÙŠÙ:', e);
            }

            // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø©
            console.log('ğŸ”„ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©...');
            window.location.href = '/';
        }

        // Ø¯Ø§Ù„Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ø¹ÙˆØ¯Ø© (ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø§Ù„Ø£ÙˆÙ„Ù‰)
        function goBackHome() {
            console.log('ğŸ  Ø¯Ø§Ù„Ø© Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©');
            gameState.isPlaying = false;
            window.location.replace('/');
        }

        // Ø¯Ø§Ù„Ø© ÙƒØªÙ…/Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ… Ø§Ù„ØµÙˆØª
        function toggleMute() {
            gameState.isMuted = !gameState.isMuted;
            const muteBtn = document.getElementById('muteBtn');

            if (gameState.isMuted) {
                muteBtn.textContent = 'ğŸ”‡';
                muteBtn.classList.add('muted');
                muteBtn.title = 'Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ… Ø§Ù„ØµÙˆØª';

                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©
                stopBackgroundMusic();

                console.log('ğŸ”‡ ØªÙ… ÙƒØªÙ… Ø§Ù„ØµÙˆØª');
            } else {
                muteBtn.textContent = 'ğŸ”Š';
                muteBtn.classList.remove('muted');
                muteBtn.title = 'ÙƒØªÙ… Ø§Ù„ØµÙˆØª';

                // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ù†Ø´Ø·Ø©
                if (gameState.isPlaying) {
                    startBackgroundMusic();
                }

                console.log('ğŸ”Š ØªÙ… Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ… Ø§Ù„ØµÙˆØª');
            }
        }

        // Ù…Ø¤Ø«Ø± Ø§Ù„Ù…Ø·Ø±
        let rainInterval = null;
        let rainTimeout = null;

        function createRaindrop() {
            const raindrop = document.createElement('div');
            raindrop.className = 'raindrop';

            // Ù…ÙˆØ¶Ø¹ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
            raindrop.style.left = Math.random() * 100 + '%';

            // Ø­Ø¬Ù… ÙˆØ³Ø±Ø¹Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
            const size = Math.random() * 3 + 1;
            const duration = Math.random() * 1 + 0.5;

            raindrop.style.height = size * 10 + 'px';
            raindrop.style.animationDuration = duration + 's';

            return raindrop;
        }

        function startRain() {
            const rainContainer = document.getElementById('rainContainer');
            if (!rainContainer) return;

            console.log('ğŸŒ§ï¸ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø·Ø±');
            rainContainer.classList.add('active');

            // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø·Ø±Ø§Øª Ø§Ù„Ù…Ø·Ø±
            rainInterval = setInterval(() => {
                if (gameState.isPlaying) {
                    const raindrop = createRaindrop();
                    rainContainer.appendChild(raindrop);

                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù‚Ø·Ø±Ø© Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø­Ø±ÙƒØ©
                    setTimeout(() => {
                        if (raindrop.parentNode) {
                            raindrop.parentNode.removeChild(raindrop);
                        }
                    }, 2000);
                }
            }, 50);

            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø·Ø± Ø¨Ø¹Ø¯ 10-15 Ø«Ø§Ù†ÙŠØ©
            const rainDuration = 10000 + Math.random() * 5000;
            rainTimeout = setTimeout(stopRain, rainDuration);
        }

        function stopRain() {
            const rainContainer = document.getElementById('rainContainer');
            if (!rainContainer) return;

            console.log('ğŸŒ¤ï¸ ØªÙˆÙ‚Ù Ø§Ù„Ù…Ø·Ø±');
            rainContainer.classList.remove('active');

            if (rainInterval) {
                clearInterval(rainInterval);
                rainInterval = null;
            }

            if (rainTimeout) {
                clearTimeout(rainTimeout);
                rainTimeout = null;
            }

            // ØªÙ†Ø¸ÙŠÙ Ù‚Ø·Ø±Ø§Øª Ø§Ù„Ù…Ø·Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
            setTimeout(() => {
                rainContainer.innerHTML = '';
            }, 2000);

            // Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠ (ÙƒÙ„ 30-60 Ø«Ø§Ù†ÙŠØ©)
            if (gameState.isPlaying) {
                const nextRainDelay = 30000 + Math.random() * 30000;
                rainTimeout = setTimeout(startRain, nextRainDelay);
            }
        }

        function initializeRain() {
            // Ø¨Ø¯Ø¡ Ø£ÙˆÙ„ Ù…Ø·Ø± Ø¨Ø¹Ø¯ 20-40 Ø«Ø§Ù†ÙŠØ© Ù…Ù† Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
            if (gameState.isPlaying) {
                const initialDelay = 20000 + Math.random() * 20000;
                rainTimeout = setTimeout(startRain, initialDelay);
            }
        }

        function stopAllRain() {
            if (rainInterval) {
                clearInterval(rainInterval);
                rainInterval = null;
            }
            if (rainTimeout) {
                clearTimeout(rainTimeout);
                rainTimeout = null;
            }

            const rainContainer = document.getElementById('rainContainer');
            if (rainContainer) {
                rainContainer.classList.remove('active');
                rainContainer.innerHTML = '';
            }
        }

        // ÙƒØ´Ù Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø­Ù…ÙˆÙ„
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                   (navigator.maxTouchPoints && navigator.maxTouchPoints > 2) ||
                   window.innerWidth <= 768;
        }

        // ØªØ¹ÙŠÙŠÙ† Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ
        function initializeBasketPosition() {
            const basketWidth = window.innerWidth <= 768 ? 100 : 110;
            const centerX = window.innerWidth / 2;
            const initialLeft = centerX - basketWidth / 2;

            basket.style.left = initialLeft + 'px';
            basket.style.transform = 'translateX(0)';
        }

        // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø³Ù„Ø© Ù…Ø¹ ØªØ­Ø³ÙŠÙ† Ù„Ù„Ù…Ø³ ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯
        function moveBasket(clientX) {
            if (!gameState.isPlaying) return;

            // ØªØ­Ø¯ÙŠØ¯ Ø­Ø¬Ù… Ø§Ù„Ø³Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø²
            const basketWidth = window.innerWidth <= 768 ? 100 : 110;

            // ØªØ­Ø¯ÙŠØ¯ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„ÙƒØ§Ù…Ù„Ø©
            const gameAreaLeft = 0;
            const gameAreaRight = window.innerWidth;

            // ØªÙ‚ÙŠÙŠØ¯ Ø­Ø±ÙƒØ© Ø§Ù„Ø³Ù„Ø© Ø¯Ø§Ø®Ù„ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„ÙƒØ§Ù…Ù„Ø©
            const minLeft = gameAreaLeft;
            const maxLeft = gameAreaRight - basketWidth;

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
            let newLeft = clientX - basketWidth / 2;
            newLeft = Math.max(minLeft, Math.min(maxLeft, newLeft));

            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            basket.style.left = newLeft + 'px';
            basket.style.transform = 'translateX(0)'; // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙˆØ³ÙŠØ· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
        }

        // Ù…ØªØºÙŠØ± Ù„ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ù…Ø³
        let isTouch = false;
        let lastTouchTime = 0;

        // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø³Ù„Ø© Ù…Ø¹ Ø§Ù„ÙØ£Ø±Ø© (Ù„Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±)
        document.addEventListener('mousemove', (e) => {
            if (gameState.isPlaying && !isTouch) {
                moveBasket(e.clientX);
            }
        });

        // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø³Ù„Ø© Ù…Ø¹ Ø§Ù„Ù„Ù…Ø³ Ø§Ù„Ù…Ø­Ø³Ù†
        document.addEventListener('touchstart', (e) => {
            if (gameState.isPlaying) {
                e.preventDefault();
                isTouch = true;
                lastTouchTime = Date.now();

                if (e.touches.length > 0) {
                    moveBasket(e.touches[0].clientX);
                }
            }
        }, { passive: false });

        document.addEventListener('touchmove', (e) => {
            if (gameState.isPlaying) {
                e.preventDefault();
                isTouch = true;
                lastTouchTime = Date.now();

                if (e.touches.length > 0) {
                    moveBasket(e.touches[0].clientX);
                }
            }
        }, { passive: false });

        document.addEventListener('touchend', (e) => {
            if (gameState.isPlaying) {
                e.preventDefault();
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ù…Ø³ Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ù‚ØµÙŠØ±Ø©
                setTimeout(() => {
                    if (Date.now() - lastTouchTime > 100) {
                        isTouch = false;
                    }
                }, 150);
            }
        }, { passive: false });

        // Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙˆØ§Ù„ØªÙƒØ¨ÙŠØ±
        document.addEventListener('touchcancel', (e) => {
            if (gameState.isPlaying) {
                e.preventDefault();
            }
        }, { passive: false });

        // Ù…Ù†Ø¹ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª
        document.addEventListener('dragstart', (e) => {
            if (gameState.isPlaying) {
                e.preventDefault();
            }
        });

        // Ù…Ù†Ø¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ù‚ÙŠØ©
        document.addEventListener('contextmenu', (e) => {
            if (gameState.isPlaying) {
                e.preventDefault();
            }
        });

        // Ø­ÙØ¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Øª Ù…Ø¹ Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø­Ø³Ù†Ø©
        async function saveGameResults() {
            const token = localStorage.getItem('token');
            if (!token) {
                console.log('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù…Ø² Ù…ØµØ§Ø¯Ù‚Ø© - Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·');
                return;
            }

            try {
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹ ØªÙØ§ØµÙŠÙ„ Ø£ÙƒØ«Ø±
                const gameData = {
                    gameName: 'Ù‚Ø·Ù Ø§Ù„ÙÙˆØ§ÙƒÙ‡ Ø§Ù„Ù…Ø·ÙˆØ±Ø©',
                    score: gameState.score,
                    level: gameState.level,
                    goldEarned: Math.max(0, gameState.goldEarned), // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù‚ÙŠÙ… Ø³Ø§Ù„Ø¨Ø©
                    pearlsEarned: Math.max(0, gameState.pearlsEarned),
                    // Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©
                    diamondsEarned: Math.max(0, gameState.diamondsEarned),
                    crystalsEarned: Math.max(0, gameState.crystalsEarned),
                    rareCoinsEarned: Math.max(0, gameState.rareCoinsEarned),
                    trophiesEarned: Math.max(0, gameState.trophiesEarned),
                    starsEarned: Math.max(0, gameState.starsEarned),
                    superStarsEarned: Math.max(0, gameState.superStarsEarned),
                    sparklesEarned: Math.max(0, gameState.sparklesEarned),
                    maxCombo: gameState.maxCombo,
                    gameTime: Date.now(),
                    finalGoldCoins: gameState.goldCoins + gameState.goldEarned,
                    finalPearls: gameState.pearls + gameState.pearlsEarned
                };

                console.log('Ø¥Ø±Ø³Ø§Ù„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù„Ø¹Ø¨Ø©:', gameData);

                const response = await fetch('/api/game/score', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(gameData)
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø¯Ù…:', data);

                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ù† Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø¯Ù…
                    if (data.goldCoins !== undefined) {
                        gameState.goldCoins = data.goldCoins;
                    }
                    if (data.pearls !== undefined) {
                        gameState.pearls = data.pearls;
                    }

                    updateDisplay();

                    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø±ØµÙŠØ¯ ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø±
                    if (window.playerHeader && data.goldCoins !== undefined) {
                        window.playerHeader.updateBalance(data.goldCoins);
                    }

                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    const errorText = await response.text();
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:', response.status, errorText);
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬:', error);
                // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ØŒ Ù†Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø­Ù„ÙŠØ§Ù‹
                gameState.goldCoins += gameState.goldEarned;
                gameState.pearls += gameState.pearlsEarned;
                updateDisplay();
            }
        }

        // Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ© Ù„Ù„Ø¹Ù…Ù„Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨
        async function syncCurrencyRealTime() {
            const token = localStorage.getItem('token');
            if (!token) return;

            try {
                const response = await fetch('/api/user/currency', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        goldCoins: gameState.goldCoins + gameState.goldEarned,
                        pearls: gameState.pearls + gameState.pearlsEarned
                    })
                });

                if (response.ok) {
                    console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…Ù„Ø§Øª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ');
                }
            } catch (error) {
                console.log('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙÙˆØ±ÙŠØ©:', error);
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        function initializeGame() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²
            if (isMobileDevice()) {
                document.getElementById('controlText').textContent = 'Ø§Ù„Ù…Ø³ Ø§Ù„Ø´Ø§Ø´Ø© ÙˆØ­Ø±Ùƒ Ø¥ØµØ¨Ø¹Ùƒ Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø³Ù„Ø©';
            }
            
            updateDisplay();
            updateCurrencyFromServer();
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        initializeGame();

        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø©
        document.addEventListener('DOMContentLoaded', function() {
            const homeBtn = document.querySelector('.home-btn');
            if (homeBtn) {
                console.log('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø©');

                // Ø¥Ø¶Ø§ÙØ© event listener Ø¥Ø¶Ø§ÙÙŠ
                homeBtn.addEventListener('click', function(e) {
                    console.log('ğŸ  ØªÙ… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© (event listener)');
                    e.preventDefault();
                    goToMainPage();
                });
            } else {
                console.log('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø©');
            }
        });

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ
        async function initializeEconomy() {
            try {
                if (window.gameEconomy) {
                    gameState.economySession = await window.gameEconomy.initializeGameSession('fruit-catching', gameState.betAmount);
                    console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ Ù„Ù‚Ø·Ù Ø§Ù„ÙÙˆØ§ÙƒÙ‡');
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ:', error);
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', async function() {
            // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª
            initAudio();

            // ØªÙ‡ÙŠØ¦Ø© Ù‡ÙŠØ¯Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨
            await window.playerHeader.init();
            const headerContainer = document.getElementById('player-header-container');
            if (headerContainer) {
                window.playerHeader.insertHeader(headerContainer);
            }

            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª
            restoreSoundSettings();

            if (window.gameEconomy) {
                await initializeEconomy();
            }
        });
    </script>
</body>
</html>